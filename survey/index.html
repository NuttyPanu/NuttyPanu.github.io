<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta name="viewport" content="initial-scale=1,user-scalable=no,initial-scale=1.0,maximum-scale=1.0,width=device-width"/>
    <meta name="mobile-web-app-capable" content="yes"/>
    <meta name="apple-mobile-web-app-capable" content="yes/">
    <meta name="theme-color" content="#000000"/>
    <meta name="description" content="For Survey"/>
    <meta name="author" content="GISPWA"/>
    <meta name="keywords" content="Survey gis pwa" />
    <!--<meta content="width=device-width,initial-scale=1.0" name="viewport" />-->

	<title>GIS Survey </title>

	<!-- icon shotcut-->
	<link rel="apple-touch-icon" sizes="57x57" href="favicon.png?v=20200225">
	<link rel="apple-touch-icon" sizes="60x60" href="favicon.png?v=20200225">
	<link rel="apple-touch-icon" sizes="72x72" href="favicon.png?v=20200225">  
	<link rel="apple-touch-icon" sizes="76x76" href="favicon.png?v=20200225">
	<link rel="apple-touch-icon" sizes="114x114" href="favicon.png?v=20200225">
	<link rel="apple-touch-icon" sizes="120x120" href="favicon.png?v=20200225">
	<link rel="apple-touch-icon" sizes="144x144" href="favicon.png?v=20200225">
	<link rel="apple-touch-icon" sizes="152x152" href="favicon.png?v=20200225">
	<link rel="apple-touch-icon" sizes="167x167" href="favicon.png?v=20200225">
	<link rel="apple-touch-icon" sizes="180x180" href="favicon.png?v=20200225">

	<link rel="icon" sizes="128x128" href="favicon.png?v=20200225">
  <link rel="icon" sizes="196x196" href="favicon.png?v=20200225">


	<!--
	<link rel="stylesheet" href="https://cdn.usebootstrap.com/bootstrap/latest/css/bootstrap.min.css"/>
	<script src="https://cdn.usebootstrap.com/bootstrap/latest/js/bootstrap.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css"/>
	-->

	<link rel="stylesheet" href="assets/fontawesome6.1.1/css/all.css">

	<style>

	    body {
	      padding: 0;
	      margin: 0;
	    }

	    html, body, #mappaint-map {
	      height: 100%;
	    }

	    /*slidemenu*/
      .content {
        margin: 0.25rem;
        border-top: 1px solid #000;
        padding-top: 0.5rem;
      }
      .header {
        font-size: 1.8rem;
        color: #7f7f7f;
      }
      .title {
        font-size: 1.1rem;
        color: #7f7f7f;
        font-weight: bold;
      }
      .bottom {
        margin-top: 64px;
        font-size: 0.8rem;
        color: #7f7f7f;
      }
					
			ul.fa-ul li{
				cursor:pointer;
				padding: 5px 0px 5px 0px;
			}

 		/*slidemenu*/

	    /*
		html, body {
			height: 100%;
			margin: 0;
		}
		#map {
			width: 600px;
			height: 400px;
		}
	
		body { padding: 0; margin: 0; } #map { height: 100%; width: 100vw; }
		*/

		/*---bookmark--*/
		span.bookmark-name{
		  	white-space: nowrap;
    		width: 200px;
    		/* border: 1px solid #000000; */
    		overflow: hidden;
    		text-overflow: ellipsis;

		}  	
		/*---bookmark--*/
		/*
		.bookmarks-list-wrapper {
			max-height: 150px!important;
		}
		*/
		@media (max-height: 479px) {
			.bookmarks-list-wrapper {
				max-height: 120px!important;
			}
		}		
		@media (min-height: 480px) and (max-height: 600px) {
			.bookmarks-list-wrapper {
				max-height: 150px!important;
			}
		}
		@media (min-height: 601px) and (max-height: 880px) {
			.bookmarks-list-wrapper {
				max-height: 230px!important;
			}
		}
		@media (min-height: 881px) {
			.bookmarks-list-wrapper {
				max-height: 100hv-150px!important;
			}
		}


		@media print {
				@page {
					size: A4;
					margin-top: 0.5;
					/*margin-bottom: 0;*/
					margin-bottom: 0.5;
					margin-right: 0.5;
					margin-left: 0.5;

				}

				#mappaint-map{
					height: 100%;
					border: 1px solid black;
				}

				.leaflet-top.leaflet-left, .leaflet-top.leaflet-right ,.leaflet-bottom.leaflet-right, .leaflet-iconLayers.leaflet-iconLayers_bottomleft.leaflet-control, .leaflet-menu{
					display: none;
				}

				.forprint{
					/*width: 21cm; height: 26.7cm; */
				}
					/*
					#leaflet-map { border: 1px solid black; }
		  		#leaflet-map { width: 17.5cm; height: 20cm; }
		  		#table-with-data { width:17cm; height: 5cm; }
					*/
				.watermark {
				    position: fixed;
				    opacity: 0.2;
				    /* Safari */
				    -webkit-transform: rotate(-60deg);
				    /* Firefox */
				    -moz-transform: rotate(-60deg);
				    /* IE */
				    -ms-transform: rotate(-60deg);
				    /* Opera */
				    -o-transform: rotate(-60deg);

				    /* Safari */
				    -webkit-transform: rotate(-45deg);
				    /* Firefox */
				    -moz-transform: rotate(-45deg);
				    /* IE */
				    -ms-transform: rotate(-45deg);
				    /* Opera */
				    -o-transform: rotate(-45deg);
				    /* Internet Explorer */
				    filter: progid:DXImageTransform.Microsoft.BasicImage(rotation=3);
				    position: absolute;
				    font-size: 130px;
				    margin-top: -650px;
				    margin-left: 20px;
				    /*
				    margin-top: -700px;
				    margin-left: -50px;
							*/
				    white-space: nowrap;
		 		}
		    
		}
		   	

	</style>

	<style>


		ul.fa-ul{
			color: #7f7f7f;
			font-size: 14px;
		}


		.ui-autocomplete {
			border: 1px solid #ced4da;
			background: white;
			z-index: 50000;
			max-height: 200px;
			max-width: 225px;
			overflow-y: auto;
			overflow-x: hidden;
		}
		

		/*-------custom scrollbar------------*/        	
		.scroller {
		  overflow-y: auto;
		  overflow-x: clip;
		  /*scrollbar-width: thin*/;
		}
		    /* Works on Firefox */
		* {
		  scrollbar-width: thin;
		  /*scrollbar-color: blue orange;*/
		  scrollbar-color: blue white;
		}

		/* Works on Chrome, Edge, and Safari */
		*::-webkit-scrollbar {
		  /*width: 12px;*/
		  width: 5px;
		}

		*::-webkit-scrollbar-track {
		  /*background: orange;*/
		}

		*::-webkit-scrollbar-thumb {
		  background-color: #a7a7a770;
		  border-radius: 5px;
		  /*
		  background-color: blue;
		  border-radius: 20px;
		  border: 3px solid orange;*/
		}
		/*-------custom scrollbar------------*/  



	</style>	


</head>

<body>

	<div id="mappaint-map"></div>

	<!--<div id='map'></div>-->
	<!--<canvas id="idCanvas" width="576" height="577"></canvas>-->


  <!-- The Modal -->
<div class="modal" id="myModal" style="z-index:50000;/*background-color: rgba(0, 0, 0, 0.7);*/" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
  <div class="modal-dialog modal-fullscreen-md-down">
    <div class="modal-content">

      <!-- Modal Header -->
      <div class="modal-header">
        <h4 class="modal-title">Modal Heading</h4>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>

      <!-- Modal body -->
      <div class="modal-body">
        Modal body..
      </div>

      <!-- Modal footer -->
      <div class="modal-footer">
        <button type="button" class="btn btn-primary">เข้าสู่ระบบ</button>      	
        <button type="button" class="btn btn-danger" data-bs-dismiss="modal">ปิด</button>

      </div>

    </div>
  </div>
</div>

<div class="modal fade" id="messageModal" style="z-index:49999;" tabindex="-1" aria-labelledby="messageModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="messageModalLabel">แจ้งปัญหา</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <form>
					<div class="form-floating">
					  <select class="form-select" id="floatingSelect" aria-label="Floating label select example">
					    <option selected>โปรดระบุหัวข้อ</option>
					    <option value="1">ข้อผิดพลาดของระบบ</option>
					    <option value="2">ชมเชย/ให้รางวัล</option>
					  </select>
					  <label for="floatingSelect">หัวข้อ</label>
					</div>

          <div class="mb-3">
            <label for="recipient-name" class="col-form-label">เรื่อง:</label>
            <input type="text" class="form-control" id="recipient-name">
          </div>
          <div class="mb-3">
            <label for="message-text" class="col-form-label">รายละเอียด:</label>
            <textarea class="form-control" id="message-text"></textarea>
          </div>
					<div class="form-floating">
					  <textarea class="form-control" placeholder="Leave a comment here" id="floatingTextarea2" style="height: 100px"></textarea>
					  <label for="floatingTextarea2">ความเห็น</label>
					</div>

        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        <button type="button" class="btn btn-primary">Send message</button>
      </div>
    </div>
  </div>
</div>

<div class="modal" id="exampleModalToggle" style="z-index:49999;" aria-hidden="true" aria-labelledby="exampleModalToggleLabel" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalToggleLabel">เกี่ยวกับระบบ</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <p>ระบบสนับสนุนการสำรวจข้อมูล GIS พัฒนาขึ้นเพื่ออำนวยความสะดวกแก่ผู้ใช้งานในการสำรวจข้อมูล GIS</p>
        <p>ผู้ใช้งานสามารถใช้งานได้โดยไม่มีค่าใช้จ่าย
        <p>สถานะ: อยู่ระหว่างการพัฒนา</p>
      </div>
      <div class="modal-footer">
        <button class="btn btn-primary" data-bs-target="#exampleModalToggle2" data-bs-toggle="modal" data-bs-dismiss="modal">เงื่อนไขการใช้งาน</button>
      </div>
    </div>
  </div>
</div>
<div class="modal" id="exampleModalToggle2" style="z-index:49999;" aria-hidden="true" aria-labelledby="exampleModalToggleLabel2" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalToggleLabel2">เงื่อนไขการใช้งาน</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        ปัจจุบัน ยังไม่มีการกำหนดสิทธิ์ของผู้ใช้งาน เนื่องจากระบบยังไม่แล้วเสร็จ
      </div>
      <div class="modal-footer">
        <button class="btn btn-primary" data-bs-target="#exampleModalToggle" data-bs-toggle="modal" data-bs-dismiss="modal">เกี่ยวกับระบบ</button>
      	<button type="button" class="btn btn-danger" data-bs-dismiss="modal">ปิด</button>
      </div>
    </div>
  </div>
</div>


<!-- Modal -->
<div class="modal fade" style="z-index:49999;" id="exportModal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="exportModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exportModalLabel">ส่งออกข้อมูล</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">

				<div class="form-floating">
				  <select class="form-select" id="ex_src" aria-label="Floating label select example1">
				    <option selected>โปรดระบุแหล่งข้อมูล</option>
				    <option value="1">Database (ตำแหน่งมาตรฯ)</option>
				    <option value="2">Localstorage (สถานที่ของคุณ)</option>
				  </select>
				  <label for="ex_src">เลือกแหล่งข้อมูล</label>
				</div>
				</br>
				<div class="form-floating">
				  <select class="form-select" id="ex_project" aria-label="Floating label select example1" onchange="if(this.value != 'โปรดระบุโครงการ'){$('#ex_name').val(this.value)}else{$('#ex_name').val('ExportProjectAll')}">
				    <option selected>โปรดระบุโครงการ</option>
				    <option value="ExportProjectAll">โครงการทั้งหมด</option>
				    <option value="ExportProject1">โครงการ1</option>
				    <option value="ExportProject2">โครงการ2</option>				    
				  </select>
				  <label for="ex_project">เลือกโครงการ</label>
				</div>
				</br>
				<div class="form-floating">
				  <select class="form-select" id="ex_type" aria-label="Floating label select example1" >
				    <option selected>โปรดระบุประเภทไฟล์</option>
				    <option value="1">JSON - File Format</option>
				    <option value="2">GeoJSON - File Format</option>
				    <option value="3">TAB - MAPINFO File - File Format</option>					    
				    <option value="4">SHP - ESRI Shapefile - File Format</option>				    
				  </select>
				  <label for="ex_type">เลือกประเภทไฟล์ส่งออก</label>
				</div>	
				</br>
				
					<div class="input-group mb-3">
					  <div class="input-group-text">
					    <input class="form-check-input mt-0" type="checkbox" value="" aria-label="" checked onclick="if(this.checked == false){$('#ex_name').removeAttr('disabled')}else{$('#ex_name').attr('disabled','disabled')}">
					  </div>
					  <input type="text" class="form-control" aria-label="Text input with checkbox" disabled="disabled" id="ex_name" value="ExportProjectAll">
					  <span class="input-group-text">ชื่อไฟล์</span>
					</div>
				  
				



      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ยกเลิก</button>
        <button type="button" class="btn btn-primary" onclick="export_data()">ตกลง</button>
      </div>
    </div>
  </div>
</div>


<!-- Modal -->
<div class="modal fade" style="z-index:49999;" id="projectModal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="projectModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg modal-dialog-centered "> <!--modal-dialog-scrollable-->
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="projectModalLabel">จัดการโครงการ</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">

					<ul class="nav nav-tabs" id="myTab" role="tablist">

					  <li class="nav-item dropdown">
					    <a class="nav-link dropdown-toggle" data-bs-toggle="dropdown" href="#" role="button" aria-expanded="false">จัดการโครงการ</a>
					    <ul class="dropdown-menu">
					      <li><a class="dropdown-item" href="#">Action</a></li>
					      <li><a class="dropdown-item" href="#">Another action</a></li>
					      <li><a class="dropdown-item" href="#">Something else here</a></li>
					      <li><hr class="dropdown-divider"></li>
					      <li><a class="dropdown-item" href="#">Separated link</a></li>
					    </ul>
					  </li>

					  <li class="nav-item" role="presentation">
					    <button class="nav-link active" id="home-tab" data-bs-toggle="tab" data-bs-target="#home-tab-pane" type="button" role="tab" aria-controls="home-tab-pane" aria-selected="true">Home</button>
					  </li>
					  <li class="nav-item" role="presentation">
					    <button class="nav-link" id="profile-tab" data-bs-toggle="tab" data-bs-target="#profile-tab-pane" type="button" role="tab" aria-controls="profile-tab-pane" aria-selected="false">Profile</button>
					  </li>
					  <li class="nav-item" role="presentation">
					    <button class="nav-link" id="contact-tab" data-bs-toggle="tab" data-bs-target="#contact-tab-pane" type="button" role="tab" aria-controls="contact-tab-pane" aria-selected="false">Contact</button>
					  </li>
					  <li class="nav-item" role="presentation">
					    <button class="nav-link" id="disabled-tab" data-bs-toggle="tab" data-bs-target="#disabled-tab-pane" type="button" role="tab" aria-controls="disabled-tab-pane" aria-selected="false" disabled>Disabled</button>
					  </li>
					</ul>


					<div class="tab-content" id="myTabContent">
					  <div class="tab-pane fade show active" id="home-tab-pane" role="tabpanel" aria-labelledby="home-tab" tabindex="0">...</div>
					  <div class="tab-pane fade" id="profile-tab-pane" role="tabpanel" aria-labelledby="profile-tab" tabindex="0">...</div>
					  <div class="tab-pane fade" id="contact-tab-pane" role="tabpanel" aria-labelledby="contact-tab" tabindex="0">...</div>
					  <div class="tab-pane fade" id="disabled-tab-pane" role="tabpanel" aria-labelledby="disabled-tab" tabindex="0">...</div>
					</div>

      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ยกเลิก</button>
        <button type="button" class="btn btn-primary" >ตกลง</button>
      </div>
    </div>
  </div>
</div>


	<div id="widgetModal" class="modal fade" role="dialog" style="z-index: 20000" >
		<div class="modal-dialog modal-lg">

			<div class="modal-content">
			  <div class="modal-header">
				
				<h4 class="modal-title" id="widgethead">ฟังก์ชันวิเคราะห์ข้อมูล GIS</h4>
			  </div>
			  <div class="modal-body" id="widgetbody">

						ตัวอย่างไฟล์สำหรับทดสอบ: 
							<a href="data/1point.json" download="1point">1point</a>
							<a href="data/2point.json" download="2point">2point</a>
							<a href="data/3point.json" download="3point">3point</a>

                          <div class="row ">
                          <form name="form1" method="post" action="\upload_img.php" enctype="multipart/form-data" style="width: 100%;padding: 10px;">
                            <div class="col-md-12">
                            <span id="helpFileupload" class="help-block"style="display:inline;">***นำเข้าข้อมูล GIS เฉพาะไฟล์นามสกุล json, geojson</span> 
                            </div>
			                  <div class="col-lg-12 col-md-12 col-xs-12" id="namePoint_up">โหลดข้อมูล:</div>                            
                            <div class="col-lg-12 col-md-12 col-xs-12" style="padding-top: 5px; padding-bottom: 5px; border-color: #d2d1d1; border-width: thin; border-style: dashed;">
                            
                              <div class="form-group">
                                <button id="Point" type="button" class="btn btn-success btn-sm" style="display: none;">Point</button>
                                
                                <input style="width:100%;" type="file" name="PointInp[]" id="PointInp" accept="application/json,.geojson" multiple="multiple"  onchange="readURL_Point();" aria-describedby="helpFileupload">
                                  <input id="txt_Point" type="hidden" class="form-control" readonly>
                                  <input id="inp_Point" name="url_Point" type="hidden" value="">
                                  <input id="inp_Point_Thumbnails" name="url_Point" type="hidden" value="">

                                <!--<img style="width:100px;" id='img-upload-preview'/>-->
                                <output id="preview_Point" />
                                <a style="cursor:pointer;display:inline;" onclick="resetImport();">ล้างข้อมูล</a>
                              </div>
                            </div>
			                  
			                  <button id="import" style="display: none;">Import</button>
			                  <div class="col-lg-12 col-md-12 col-xs-12" id="namePoint_up">รายละเอียดข้อมูล:</div>
                              <div class="col-lg-12 col-md-12 col-xs-12" id="imgPoint_up"></div>
			                  <textarea class="col-lg-12 col-md-12 col-xs-12 form-control" row="20" id="result" style="min-height:100px;overflow:auto;resize:vertical;" wrap="virtual">
			                    
			                  </textarea>
		
                          </form>               
                          </div>

			  </div>
			  
			  <div class="modal-footer" id="widgetfooter">
				
			  </div>
			  
			</div>

			</div>
		</div>
	</div>
 	
	<!--
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.8.0/dist/leaflet.css" crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.8.0/dist/leaflet.js" crossorigin=""></script>
	--> 

    <!--
	<link rel="stylesheet" href="https://unpkg.com/leaflet@1.4.0/dist/leaflet.css"/>
	<script src="https://unpkg.com/leaflet@1.4.0/dist/leaflet.js"></script>
	-->   


	<script src="assets/jquery/jquery-3.3.1.js?v=001"></script>	
	<script src="assets/jquery-ui.js?v=001"></script> <!-- autocomplete-->
	<script src="assets/FileSaver.min.js?v=001"></script> <!-- export file-->	

	<!--
	<link rel="stylesheet" href="assets/bootstrap5/bootstrap.min.css"/>
	<script src="assets/bootstrap5/bootstrap.min.js"></script>
	-->

	<link rel="stylesheet" href="assets/bootstrap5/css/bootstrap.css"/>
	<script src="assets/bootstrap5/js/bootstrap.bundle.js"></script>

	<link rel="stylesheet" href="leaflet/leaflet1.6/leaflet.css"/>
	<script src="leaflet/leaflet1.6/leaflet-src.js"></script>

	<!--<script src="leaflet/clicktolerance/src/index.js?v=001" type="text/javascript"></script>-->


		<link rel="stylesheet" href="leaflet/draw/leaflet.draw.css?v=20200226"/>
    <script src="leaflet/draw/Leaflet.draw_dev.js?v=20200225"></script>
    <script src="leaflet/draw/Leaflet.Draw.Event.js?v=20200225"></script>

    <script src="leaflet/draw/Toolbar.js?v=20200225"></script>
    <script src="leaflet/draw/Tooltip.js?v=20200225"></script>

    <script src="leaflet/draw/ext/GeometryUtil.js?v=20200225"></script>
    <script src="leaflet/draw/ext/LatLngUtil.js?v=20200225"></script>
    <script src="leaflet/draw/ext/LineUtil.Intersect.js?v=20200225"></script>
    <script src="leaflet/draw/ext/Polygon.Intersect.js?v=20200225"></script>
    <script src="leaflet/draw/ext/Polyline.Intersect.js?v=20200225"></script>
    <script src="leaflet/draw/ext/TouchEvents.js?v=20200225"></script>

    <script src="leaflet/draw/draw/DrawToolbar.js?v=20200225"></script>
    <script src="leaflet/draw/draw/Draw.Feature.js?v=20200225"></script>
    <script src="leaflet/draw/draw/Draw.SimpleShape.js?v=20200225"></script>
    <script src="leaflet/draw/draw/Draw.Polyline.js?v=20200226"></script>
    <script src="leaflet/draw/draw/Draw.Marker.js?v=20200225"></script>
    <script src="leaflet/draw/draw/Draw.Circle.js?v=20200225"></script>
    <script src="leaflet/draw/draw/Draw.CircleMarker.js?v=20200225"></script>
    <script src="leaflet/draw/draw/Draw.Polygon.js?v=20200225"></script>
    <script src="leaflet/draw/draw/Draw.Rectangle.js?v=20200225"></script>

    <script src="leaflet/draw/edit/EditToolbar.js?v=20200225"></script>
    <script src="leaflet/draw/edit/EditToolbar.Edit.js?v=20200225"></script>
    <script src="leaflet/draw/edit/EditToolbar.Delete.js?v=20200225"></script>

    <script src="leaflet/draw/Control.Draw.js?v=20200225"></script>

    <script src="leaflet/draw/edit/Edit.Poly.js?v=20200225"></script>
    <script src="leaflet/draw/edit/Edit.SimpleShape.js?v=20200225"></script>
    <script src="leaflet/draw/edit/Edit.Rectangle.js?v=20200225"></script>
    <script src="leaflet/draw/edit/Edit.Marker.js?v=20200225"></script>
    <script src="leaflet/draw/edit/Edit.CircleMarker.js?v=20200225"></script>
    <script src="leaflet/draw/edit/Edit.Circle.js?v=20200225"></script>


   <link rel="stylesheet" href="leaflet/grouplayercontrol/leaflet.groupedlayercontrol.css?v=20170830">
   <script src="leaflet/grouplayercontrol/leaflet.groupedlayercontrol.js?v=20170831"></script>

	<link rel="stylesheet" href="leaflet/clustermarker/dist/MarkerCluster.css" />
	<link rel="stylesheet" href="leaflet/clustermarker/dist/MarkerCluster.Default.css" />
	<script src="leaflet/clustermarker/dist/leaflet.markercluster-src.js"></script>

	<script src="leaflet/boxzoom/leaflet-control-boxzoom-src.js?v=001"></script>
	<link rel="stylesheet" href="leaflet/boxzoom/leaflet-control-boxzoom.css?v=002" type="text/css" />	


	<link rel="stylesheet" href="leaflet/zoominfo/src/L.Control.Zoominfo.css" />
	<script src="leaflet/zoominfo/src/L.Control.Zoominfo.js" ></script>



    <link rel="stylesheet" href="leaflet/slidemenu/src/L.Control.SlideMenu.css?v=001" />
    <script src="leaflet/slidemenu/src/L.Control.SlideMenu.js?v=002"></script>

    <link rel="stylesheet" href="leaflet/reticlescale/src/leaflet-reticle.css">
    <script src="leaflet/reticlescale/src/leaflet-reticle.js"></script>

    <link rel="stylesheet" href="leaflet/cascadebutton/src/L.cascadeButtons.css">
    <script src="leaflet/cascadebutton/src/L.cascadeButtons.js"></script>


    <script type="text/javascript" src="leaflet/iconlayer/providers.js"></script>
    <script type="text/javascript" src="leaflet/iconlayer/src/iconLayers.js"></script>
    <link rel="stylesheet" href="leaflet/iconlayer/src/iconLayers.css?v=001">


	<!-- Leaflet-Rotate 
	<script src="leaflet/rotate/dist/leaflet-rotate-src.js?v=001"></script>

	<script src="leaflet/rotate/misc/route.js"></script>
	<script src="leaflet/rotate/misc/places.js"></script>
	<script src="leaflet/rotate/misc/loremIpsum.js"></script>
	<script src="leaflet/rotate/lib/debug.js"></script>
	-->

	
	<script type="text/javascript" src="leaflet/bookmarks/L.Control.Bookmarks.js?v=005"></script>
    <link rel="stylesheet" href="leaflet/bookmarks/leaflet.contextmenu.css?v=2021" />	
    <link rel="stylesheet" href="leaflet/bookmarks/leaflet.bookmarks_use.css?v=003" />
    <link rel="stylesheet" href="leaflet/bookmarks/leaflet.modal.css?v=2021" />
	

    
    <script src="leaflet/mappaint/dist/MapPaint_dev.js?v=001"></script>
    <link rel="stylesheet" href="leaflet/mappaint/dist/MapPaint_dev.css?v=003" type="text/css" />
	
     <script src="leaflet/modal/src/L.Control.Window.js?v=001"></script>
     <link rel="stylesheet" href="leaflet/modal/src/L.Control.Window.css" />

	
		<link rel="stylesheet" href="leaflet/locate/dist_custom/L.Control.Locate.css?v=001" />
    <script src="leaflet/locate/dist_custom/L.Control.Locate.js?v=001" ></script>


	 	<script src="leaflet/mouseposition/L.LatLng.UTM.js?v=001" ></script>
		<link rel="stylesheet" href="leaflet/mouseposition/L.Control.MousePosition.css?v=001"/>	 	
		<script src="leaflet/mouseposition/L.Control.MousePosition.js?v=002"></script>


	<script src="leaflet/togeojson.js?v=20211100"></script>
	<script src="leaflet/geojson.js"></script>

	

    <!--<script src="turf/exportfile/FileSaver.min.js?v=20210110"></script>--> 
    <script src="turf/turf.min.js" charset="utf-8"></script>

	<!--<script src='https://unpkg.com/@turf/turf@6.3.0/turf.min.js'></script>-->

    <link rel="stylesheet" href="widget/widget.css?v=0033">
	<script src="widget/widget.js?v=0036"></script>
    <script src="turf/turfanalysis.js?v=20210121"></script>  



	<script src="leaflet/edgegrid/leaflet.edgescalebar_use.js?v=003"></script>
	<script>
		var edgeBar =L.edgeScaleBar();
		//edgeBar.addTo(map);
 	</script>

 	<script src="leaflet/edgegrid/leaflet.latlng-graticule.js?v=001"></script>
	<script>
		var edgeGrat =	L.latlngGraticule({
			    showLabel: true,
			    opacity: 1,
			    weight: 0.8,
				//color: '#aaa',
				color: '#46505a',
				font: '12px Verdana',
				//fontColor: '#aaa',
				fontColor: '#46505a',					
				//dashArray:[0,0],
				//sides: ['N', 'S', 'E', 'W'],
			    dashArray: [5, 5],
			    zoomInterval: [
				    //{start: 2, end: 2, interval: 40},
				    //{start: 3, end: 3, interval: 20},
				    //{start: 4, end: 4, interval: 10},
				    {start: 5, end: 6, interval: 5},
				    {start: 6, end: 7, interval: 3},			
				    {start: 7, end: 8, interval: 2},				    	    
				    {start: 8, end: 9, interval: 1},
				    {start: 9, end: 10, interval:  0.500},
				    {start: 10, end: 11, interval: 0.300},				    
				    {start: 11, end: 13, interval: 0.100},
				    {start: 13, end: 15, interval: 0.050},
				    {start: 14, end: 15, interval: 0.025},				    
				    {start: 15, end: 16, interval: 0.010},
				    {start: 16, end: 17, interval: 0.005},

				    {start: 17, end: 18, interval: 0.001},				    				    
				    {start: 18, end: 19, interval: 0.0009},
				    {start: 19, end: 21, interval: 0.0005},
				    {start: 21, end: 30, interval: 0.00009},
		    
			    ],
			  /*
			  zoomInterval: {
			    latitude: [
			      {start: 4, end: 6, interval: 5},
			      {start: 7, end: 20, interval: 1}
			    ],
			    longitude: [
			      {start: 4, end: 6, interval: 10},
			      {start: 7, end: 20, interval: 2}
			    ]
			  }
				*/

			});

		//edgeGrat.addTo(map);
	</script>

	<!--
	<style>

		#btn1, #btn2, #btn3{
			position: relative;
			z-index: 49999;
		}
		#sect1,#sect2,#sect3,#sect4,#sect5,#sect6,#sect7,#sect8,#sect9,#sect10{
			position: relative;
			z-index: 49999;
		}

		.shown1{
		  display: block !important;
		  animation: fade_in_anim 0.5s;
		  animation-duration: 0.5s;
		}
		.btn_active_state{
		  background-color: #FFCC00 !important;
		}
		@keyframes fade_in_anim {
		  0% {
		    opacity: 0;
		    transform: translateY(-30px);
		  }
		  100% {
		    opacity: 1;
		    transform: translateY(0px);
		  }
		}
		[id^='sect'] {
		  display: none;
		}
		.fade1 {
		    transition: opacity .15s linear;
		}

	</style>

	<button id="btn1">btn1</button>
	<button id="btn2">btn2</button>
	<button id="btn3">btn3</button>
	<button id="sect1">sect1</button>
	<button id="sect2">sect2</button>
	<button id="sect3">sect3</button>
	<button id="sect4">sect4</button>
	<button id="sect5">sect5</button>
	<button id="sect6">sect6</button>
	<button id="sect7">sect7</button>
	<button id="sect8">sect8</button>
	<button id="sect9">sect9</button>
	<button id="sect10">sect10</button>
	<button id="sect11">sect11</button>
	<button id="sect12">sect12</button>

	<script>
		const buttons = [...document.querySelectorAll("[id^='btn']")]
		const mapping = [[0, 4], [4, 8], [8,12]]
		const sections = [...document.querySelectorAll("[id^='sect']")]

		for(let i = 0; i < 3; i++) {
		  buttons[i].addEventListener('click', function(event) {
		    event.preventDefault();
		    toggleDivs(this)
		    for(let j = mapping[i][0]; j < mapping[i][1]; j++) {
		      sections[j].classList.add("shown1", "fade1")
		    }
		  })
		}

		function toggleDivs(btn){
		  buttons.forEach(b => b.classList.remove("btn_active_state"))
		  btn.classList.add("btn_active_state")
		  sections.forEach(s => s.classList.remove('shown1'))
		}

		//force button1 state initialise, if required
		btn1.focus();
		btn1.click();	

	</script>
	-->

	<script>


	   /*
		//var map = L.map('map').fitWorld();
		var map = L.map("map", {
			//position: bottomright,
		    //attributionControl: false,
		    zoomControl: true
		}).setView(new L.LatLng(13.901111, 100.752778), 14);
		*/


		var map = L.map("mappaint-map", {
		//var map = L.map('map', {
			//zoominfoControl: true,

			zoomSnap: 0.25,
			zoomDelta: 0.25,
			wheelPxPerZoomLevel: 180,	
					
			zoomControl: false,
			zoom: 6, 
			center: [13.901111, 100.752778], 
			attributionControl: true,
			//scrollWheelZoom: false,


			/*-----rotate-----*/
			//// worldCopyJump: true,
			//rotate: true,
			//touchRotate: true,
			//rotateControl: {
			//	closeOnZeroBearing: false
			//},
			//bearing: 0,
			/*-----rotate-----*/

	    });


		if( navigator.userAgent.match(/Windows NT/i) || navigator.platform.indexOf('Win') > -1){
			var mouselocation = L.control.mousePosition({ position: 'bottomright' }).addTo(map);
		}
		else if( (navigator.userAgent.match(/Macintosh|MacOS|Mac/i) && (('ontouchstart' in document.documentElement) == false ||'ontouchstart' in window == false) ) || 
			(navigator.platform === 'MacIntel' && navigator.maxTouchPoints <= 0)){
			var mouselocation = L.control.mousePosition({ position: 'bottomright' }).addTo(map);
		}
		else if( /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) || 
			(navigator.userAgent.match(/Macintosh|iPad/i) && (('ontouchstart' in document.documentElement) == true ||'ontouchstart' in window == true)) || 
			((navigator.platform === 'MacIntel' && navigator.maxTouchPoints > 0) || navigator.platform === 'iPad')) {
		}
		else{
			//var mouselocation = L.control.mousePosition({ position: 'bottomright' }).addTo(map);
		}

		var zoomctrl = new L.Control.Zoominfo({position: 'bottomright'}).addTo(map);
		//var zoomctrl = new L.Control.Zoom({ position: 'bottomright' }).addTo(map);


		if( navigator.userAgent.match(/Windows NT/i) || navigator.platform.indexOf('Win') > -1){
			L.Control.boxzoom({position:'bottomright',}).addTo(map);
		}
		else if( (navigator.userAgent.match(/Macintosh|MacOS|Mac/i) && (('ontouchstart' in document.documentElement) == false ||'ontouchstart' in window == false) ) || 
			(navigator.platform === 'MacIntel' && navigator.maxTouchPoints <= 0)){
			L.Control.boxzoom({position:'bottomright',}).addTo(map); 
		}
		else if( /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) || 
			(navigator.userAgent.match(/Macintosh|iPad/i) && (('ontouchstart' in document.documentElement) == true ||'ontouchstart' in window == true)) || 
			((navigator.platform === 'MacIntel' && navigator.maxTouchPoints > 0) || navigator.platform === 'iPad')) {
		}
		else{
			//var mouselocation = L.control.mousePosition({ position: 'bottomright' }).addTo(map);
		}


    var LocationMarker = L.Marker.extend({
        initialize: function (latlng, options) {
            L.Util.setOptions(this, options);
            this._latlng = latlng;
            this.createIcon();
        },

        /**
         * Create a styled circle location marker
         */
        createIcon: function() {
            var opt = this.options;

            var style = '';

            if (opt.color !== undefined) {
                style += 'stroke:'+opt.color+';';
            }
            if (opt.weight !== undefined) {
                style += 'stroke-width:'+opt.weight+';';
            }
            if (opt.fillColor !== undefined) {
                style += 'fill:'+opt.fillColor+';';
            }
            if (opt.fillOpacity !== undefined) {
                style += 'fill-opacity:'+opt.fillOpacity+';';
            }
            if (opt.opacity !== undefined) {
                style += 'opacity:'+opt.opacity+';';
            }

            var icon = this._getIconSVG(opt, style);

            this._locationIcon = L.divIcon({
                className: icon.className,
                html: icon.svg,
                iconSize: [icon.w,icon.h],
            });

            this.setIcon(this._locationIcon);
        },

        /**
         * Return the raw svg for the shape
         *
         * Split so can be easily overridden
         */
        _getIconSVG: function(options, style) {
            var r = options.radius;
            var w = options.weight;
            var s = r + w;
            var s2 = s * 2;
            var svg = '<svg xmlns="http://www.w3.org/2000/svg" width="'+s2+'" height="'+s2+'" version="1.1" viewBox="-'+s+' -'+s+' '+s2+' '+s2+'">' +
            '<circle r="'+r+'" style="'+style+'" />' +
            '</svg>';
            return {
                className: 'leaflet-control-locate-location',
                svg: svg,
                w: s2,
                h: s2
            };
        },

        setStyle: function(style) {
            L.Util.setOptions(this, style);
            this.createIcon();
        }
    });

    var CompassMarker = LocationMarker.extend({
        initialize: function (latlng, heading, options) {
            L.Util.setOptions(this, options);
            this._latlng = latlng;
            this._heading = heading;
            this.createIcon();
            //alert(heading);
        },

        setHeading: function(heading) {
            //alert(heading);
            this._heading = heading;
        },

        /**
         * Create a styled arrow compass marker
         */
        _getIconSVG: function(options, style) {
            var r = options.radius;
            var w = (options.width + options.weight);
            var h = (r+options.depth + options.weight)*2;
            var path = 'M0,0 l'+(options.width/2)+','+options.depth+' l-'+(w)+',0 z';
            var svgstyle = 'transform: rotate('+this._heading+'deg)';
            var svg = '<svg xmlns="http://www.w3.org/2000/svg" width="'+(w)+'" height="'+h+'" version="1.1" viewBox="-'+(w/2)+' 0 '+w+' '+h+'" style="'+svgstyle+'">'+
            '<path d="'+path+'" style="'+style+'" />'+
            '</svg>';
            return {
                className: 'leaflet-control-locate-heading',
                svg: svg,
                w: w,
                h: h
            };
        },
    });


		var lc = L.control.locate({
			position: 'bottomright',

      strings: {
          title: "ตำแหน่งปัจจุบัน",
          metersUnit: "เมตร",
          //feetUnit: "feet",
					popup: "{latlng} <br>ระยะรัศมี {distance} {unit} จากตำแหน่งนี้",
    			outsideMapBoundsMsg: "ตำแหน่งของคุณออกนอกขอบเขตของแผนที่",        
      },
      flyTo: false,
      returnToPrevBounds: false,
			cacheLocation:false,
			enableHighAccuracy: true,
      showPopup: true,
			metric: true,

			showCompass: true,
      compassClass: CompassMarker,				
      compassStyle: {
          fillColor:   '#2A93EE',
          fillOpacity: 1,
          weight:      0,
          color:       '#fff',
          opacity:     1,
          radius:      9, // How far is the arrow is from the center of of the marker
          width:       9, // Width of the arrow
          depth:       6  // Length of the arrow
      },
      //followCompassStyle: {},
			clickBehavior: {inView: 'stop', outOfView: 'setView', inViewNotFollowing: 'inView'},	

			locateOptions: {
				//watch: true,  // if you overwrite this, visualization cannot be updated
        //setView: false // have to set this to false because we have to
				//setView: 1,
				//setView: false, 'once', 'always', 'untilPan', or 'untilPanOrZoom',
				//setView: always,
				maxZoom: 17,//Infinity
				timeout: 500,
				maximumAge:500,
			},


		}).addTo(map);

		map.on('locationfound', function (evt) {
		 var savedLatLng = evt.latlng;
		  console.log(savedLatLng);
		});

      /* contents slidemenu */
      const left = '<div class="header" style="font-size:16px;font-weight:bold;">ระบบสนับสนุนการสำรวจข้อมูล GIS</div>';
      //const right = '<div class="header">Slide Menu (Right)</div>';
      /*
      let contents = `
            <div class="content">
                <div class="title">Read Me</div>
                <p>A simple slide menu for Leaflet.<br>
                When you click the menu button and the menu is displayed to slide.<br>
                Please set the innerHTML to slide menu.</p>
                <div class="title">Usage</div>
                <p>L.control.slideMenu("&lt;p&gt;test&lt;/p&gt;").addTo(map);</p>
                <div class="title">Arguments</div>
                <p>L.control.slideMenu(&lt;String&gt;innerHTML, &lt;SlideMenu options&gt;options?)</p>
                <div class="title">Options</div>
                <p>position<br>
                menuposition<br>
                width<br>
                height<br>
                direction<br>
                changeperc<br>
                delay<br>
                icon<br>
                hidden</p>
                <div class="title">Methods</div>
                <p>setContents(&lt;String&gt;innerHTML)</p>
                <div class="bottom">
                    <span>License <span style="font-weight: bold">MIT</span></span>
                </div>
            </div>`;
       */

			
      let contents = `
      <div class="content">

				<div class="input-group input-group-sm mt-1 mb-1">
				  <input type="text" class="form-control" placeholder="ค้นหา" id="btnsearch">
				  <button class="btn btn-primary" type="submit"><i class="fas fa-search"></i></button>
				</div>

				<hr>  
				<div class="mx-3">
					พื้นที่เก็บข้อมูล
					<div class="progress" style="height: 15px;">
					  <div class="progress-bar" role="progressbar" style="width: 0%;" aria-valuenow="50" aria-valuemin="0" aria-valuemax="100">0%</div>
						<div class="progress-bar" role="progressbar" style="color: #000000;position: relative;width: 80%;display: initial;/* float: left; */background: #e9ecef00;" aria-valuenow="80" aria-valuemin="0" aria-valuemax="80"></div>

					</div>
					ใช้ไป <span id="localstorage">0 MB</span> จาก 10 MB <pre>(Memory On Browser)</pre>
				</div>


						  <div class="row-fluid" style="padding: 0px 20px 0px 20px;">

								<button type="button" class="btn btn-sm btn-default pull-left" id="proj" name="gis" title="จัดการโครงการ" style="border: 1px solid #8f8f8f; width: 44px; margin-top: -6px; display: inline-block;" onclick="$('#projectModal').modal('show');"><img width="25px" src="img/import.png" style="">
								</button>

								<select class="" aria-label="Disabled select example" disabled style="width: 70%;height: 36px;font-size: 14px;">
								  <option selected> ยังไม่มีโครงการ</option>
								  <option value="1">One</option>
								  <option value="2">Two</option>
								  <option value="3">Three</option>
								</select>
					
							</div>


				<hr> 
				
				<!--<ul class="fa-ul">
				  <li><i class="fa-li fa fa-database"></i>โครงการ</li>
				  <li><i class="fa-li fa fa-map"></i>เพิ่ม/แก้ไขแผนที่</li>
				</ul>
				<hr>-->  
				        
				<ul class="fa-ul">
				  <li><i class="fa-li fa fa-bookmark"></i>สถานที่ของคุณ</li>
				  <li><i class="fa-li fa fa-commenting"></i>การมีส่วนร่วมของคุณ</li>
				  <li><i class="fa-li fa fa-map-marker-alt"></i>การแชร์ตำแหน่ง</li>
				</ul>
				<hr>  
				<ul class="fa-ul">
				  
				  <li onclick="import_data()"><i class="fa-li fa fa-upload"></i>นำเข้าข้อมูล</li> 
				  <li data-bs-toggle="modal" href="#exportModal" role="button""><i class="fa-li fa fa-download"></i>ส่งออกข้อมูล</li> 
				  <li onclick="forPrint();"><i class="fa-li fa fa-print"></i>พิมพ์แผนที่</li> 
				  <li><i class="fa-li fa fa-gear"></i>การตั้งค่า</li>
				  <li data-bs-toggle="modal" href="#messageModal" role="button"><i class="fa-li fa fa-bullhorn"></i>แจ้งปัญหา</li>
				  <li data-bs-toggle="modal" href="#exampleModalToggle" role="button"><i class="fa-li fa fa-info-circle"></i>เกี่ยวกับ</li> 


				</ul>
				<hr>  
				<ul class="fa-ul">
				  <li onclick="" data-bs-toggle="collapse" href="#collapseExample" role="button" aria-expanded="false" aria-controls="collapseExample"><i class="fa-li fa -hdd-o"></i>ฟังก์ชันวิเคราะห์ข้อมูลเชิงพื้นที่</li> 				
				</ul>
				<hr>  
				<div class="collapse" id="collapseExample">
						<div class="panel-body" style="margin-top: 0px;">
							<div id="reg_all">

							</div>

						  <h5 id="head-pwa">ฟังก์ชันวิเคราะห์ข้อมูลเชิงพื้นที่</h5>

						  <div class="row-fluid" style="padding: 5px 20px 5px 20px;">
								<button type="button" class="btn btn-sm btn-default pull-left" id="gis1" name="gis" title="นำเข้าข้อมูล GIS" style="border: 1px solid #8f8f8f; width: 44px; margin-top: -6px; display: inline-block;" onclick="widgetModal('about');"><img width="25px" src="img/import.png" style=""></button>

								<button type="button" class="btn btn-sm btn-default pull-left" id="gis2" name="gis" title="ทำบัฟเฟอร์" style="border: 1px solid #8f8f8f; width: 44px; margin-top: -6px; display: inline-block;" onclick="widgetModal('buffer');"><img width="25px" src="img/buffer.png" style=""></button>
								<button type="button" class="btn btn-sm btn-default pull-left" id="gis3" name="gis" title="หาพื้นที่ซ้อนทับ" style="border: 1px solid #8f8f8f; width: 44px; margin-top: -6px; display: inline-block;" onclick="widgetModal('intersect');"><img width="25px" src="img/intersect.png" style=""></button>
								<button type="button" class="btn btn-sm btn-default pull-left" id="gis4" name="gis" title="export geoJSON" style="border: 1px solid #8f8f8f; width: 44px; margin-top: -6px; display: inline-block;" onclick="widgetModal('export');"><img width="25px" src="img/download.png" style=""></button>
							</div>

							<div class="row-fluid" style="padding:  0px 20px 5px 20px;"></div>


						  	<div class="row-fluid" style="padding: 0px 20px;">
								<button type="button" class="btn btn-sm btn-default pull-left" id="gis5" name="gis" title="Union" style="border: 1px solid #8f8f8f; width: 44px; margin-top: -6px; display: inline-block;" onclick=""><img width="25px" src="img/union.png" style=""></button>

								<button type="button" class="btn btn-sm btn-default pull-left" id="gis6" name="gis" title="สอบถามข้อมูล" style="border: 1px solid #8f8f8f; width: 44px; margin-top: -6px; display: inline-block;" onclick=""><img width="25px" src="img/search.png" style=""></button>
								
							</div>	

							<div class="row-fluid" style="padding: 5px;"></div>

							<div class="row-fluid" style="padding: 5px;">*** อยู่ระหว่างการพัฒนา</div>

							
						</div>
					
				</div>

				<div class="panel-body" style="margin-top: 0px;width:100%; text-align:center;">
				  <div id="resampled"></div>
					<!--<img src="" id="resampled">-->
				</div>
 


      </div>`;
      /* left */
      L.control.slideMenu(left + contents, {delay: "10"}).addTo(map);
   		
			$('.leaflet-menu').css('box-shadow', '#222 -1px -1px 0px 0px');
			$('button.leaflet-menu-close-button').click(function(){
				//alert('close');
				$('.leaflet-menu').css('box-shadow', '#222 -1px -1px 0px 0px');
			});

			$('a.leaflet-bar-part.leaflet-bar-part-single').click(function(){
				//alert('open');
				if($('.leaflet-menu').css('left') == '0px'){
				}
				$('.leaflet-menu').css('box-shadow', '#222 -1px -1px 20px 0px');

			});


			var stat_login=0;
			function login(){

				$('#myModal .modal-title').html('เข้าสู่ระบบ');
				$('#myModal .modal-body').html(`
					<div class="container-sm">
						<div class="grid" style="--bs-rows: 3; --bs-columns: 5;">
				 					<div class="mt-5 mb-3 px-5"><h6> <img src="favicon.png" width="25" height="25" > กรอกรหัสพนักงานและรหัสผ่านเพื่อเข้าระบบ</h6></div>
									<div class="input-group mb-3 g-start-3 px-5" >
									  <span class="input-group-text" id="basic-addon1"><i class="fa fa-user" aria-hidden="true"></i></span>
									  <input type="text" class="form-control" placeholder="รหัสพนักงาน" aria-label="Username" aria-describedby="basic-addon1">
									</div>

									<div class="input-group mb-3 g-start-3 px-5" style="grid-row: 2">
									  <span class="input-group-text" id="basic-addon2"><i class="fa fa-lock" aria-hidden="true"></i></span>
									  <input type="password" class="form-control" placeholder="รหัสผ่าน" aria-label="Username" aria-describedby="basic-addon1">
									</div>

									<div class="form-check g-start-3 px-5 ms-4" style="grid-row: 3">
									  <input class="form-check-input" type="checkbox" value="" id="flexCheckDefault">
									  <label class="form-check-label" for="flexCheckDefault">
									    จำรหัสผ่าน
									  </label>
									</div>
									</br>
									</br>

						</div>
					</div>

				`);



				$('#myModal').modal('show');
				if(stat_login==0){
					$('button.fas.fa-sign-in.fa-lg').removeClass('fa-sign-in').addClass('fa-user-circle').attr('title','พ.12974');
					stat_login=1;
				}
				else{
					$('button.fas.fa-user-circle.fa-lg').removeClass('fa-user-circle').addClass('fa-sign-in').attr('title','เข้าสู่ระบบ');
					stat_login=0;					
				}
				
			}		

			function import_data(){
				widgetModal('about');
				//alert('อยู่ระหว่างพัฒนา');
			}			
			function export_data(){

				if($('#ex_src option:selected').val() == 2 && ($('#ex_type option:selected').val() == 1 || $('#ex_type option:selected').val() == 2) && $('#ex_name').val() != ''){
					exportgeojson($('#ex_name').val(),$('#ex_type option:selected').val());
				}
				else{
					alert('รองรับการส่งออกข้อมูล สำหรับสถานที่ของคุณ ในรูปแบบไฟล์ JSON หรือ GeoJSON และโปรดตั้งชื่อไฟล์ (อยู่ระหว่างพัฒนา)');
				}

			}			
      /* right 
      const slideMenu = L.control
        .slideMenu("", {
          position: "topright",
          menuposition: "topright",
          width: "30%",
          height: "400px",
          delay: "50",
          icon: "chevron-left",
        })
        .addTo(map);
      slideMenu.setContents(right + contents);
	  */

	  	/*
        var retiscale = L.control.reticle({
                mapId: "mappaint-map",
                metric: true,
                fetchElevation: true
        }).addTo(map);
       */

    var scaleM = L.control.scale({position: 'bottomleft',metric: true,imperial:false}).addTo(map);

		var cascade = new L.cascadeButtons([
		    {icon: 'fas fa-sign-in fa-lg', title: 'เข้่าสู่ระบบ', ignoreActiveState:true , command: () =>{login(); }},			
		    {icon: 'fas fa-print fa-lg', title: 'พิมพ์แผนที่', ignoreActiveState:true , command: () =>{forPrint(); }},
		    {icon: 'fas fa-expand-arrows-alt fa-lg', title: 'ซูมแผนที่ทั้งหมด', ignoreActiveState:true , command: () =>{map.setView([13.901111, 100.752778], 6); }},		    
		    {icon: 'fas fa-edit fa-lg btn-main-4', title: 'เพิ่มข้อมูล GIS', items:[
		        {icon: 'fas fa-crosshairs fa-lg btn-sub-41', title: 'เพิ่มตำแหน่งมาตร',command: () =>{openModal()}},
		        {icon: 'fas fa-home fa-lg btn-sub-42', title: 'เพิ่มอาคาร',command: () =>{alert('อยู่ระหว่างหาผู้รับจ้าง')}},
		        {icon: 'fas fa-arrows-alt-h fa-lg btn-sub-43', title: 'เพิ่มท่อ',command: () =>{alert('อยู่ระหว่างหาผู้รับจ้าง')}},
		        {icon: 'fas fa-search fa-lg btn-sub-44', title: 'ดูข้อมูลมาตรทั้งหมด',command: () =>{getmongo()}},		        
		    ]},
		    {icon: 'fas fa-ruler-combined fa-lg btn-main-2', title: 'การคำนวณเชิงพื้นที่', items: [
		        {icon: 'fas fa-tape fa-lg btn-sub-21', title: 'คำนวณระยะทาง',command: () =>{console.log('distance')}},
		        {icon: 'fas fa-sign fa-lg btn-sub-22', title: 'คำนวณพื้นที่',command: () =>{alert('มีบั๊ค เคสเพิ่มหลายๆpolygon ลบได้แค่ล่าสุด (แก้โดย add group layer)')}},
		    ]},
		    /*
		    {icon: 'fas fa-file-export fa-lg btn-main-2', title: 'ดาวน์โหลดข้อมูล', items: [
		        {icon: 'fas fa-file-archive fa-lg btn-sub-21', title: 'ดาวน์โหลดข้อมูลจากสถานที่ของคุณเป็น geojson',command: () =>{exportgeojson()}},
		        {icon: 'fas fa-file-alt fa-lg btn-sub-22', title: 'ดาวน์โหลด .tab',command: () =>{console.log('hola')}},
		    ]},	
		    */	    
		], {position:'topright', direction:'horizontal'}).addTo(map);

		//$(".btn-main-2").css({'margin-top':'-33px','display':'none'});
		$(".btn-sub-21").css({'margin-top':'-33px','display':'none'});
		$(".btn-sub-22").css({'margin-top':'-33px','display':'none'});

		//$(".btn-main-4").css({'margin-top':'-33px','display':'none'});
		$(".btn-sub-41").css({'margin-top':'-33px','display':'none'});
		$(".btn-sub-42").css({'margin-top':'-33px','display':'none'});
		$(".btn-sub-43").css({'margin-top':'-33px','display':'none'});
		$(".btn-sub-44").css({'margin-top':'-33px','display':'none'});

		$("button.fas.fa-file-export.fa-lg.btn-main-2").on('click', function(e) {
		  console.log('clicked');
		  //el.addEventListener('focus', addLabel );
		  //el.addEventListener('keydown', removeLabel );
		  //el.focus();
		  //activeButton
		}, false );
				var pointData;
				var points = L.geoJson(pointData, {
				  pointToLayer: function (feature, latlng) {
				    return L.marker(latlng, {
				      icon: L.icon({
				        iconUrl: "img/meter.png",
				        iconSize: [30, 30]
				        /*,
				        iconAnchor: [12, 28],
				        popupAnchor: [0, -25]
				        */
				      }),
				      title: "เลขมาตร "+feature.properties.name,
				      riseOnHover: true
				    });
				  },
				  onEachFeature: function (feature, layer) {
					 
				    if (feature.properties) {
							/*
				      var content = 
				      "<table id='tblpwa' class='table table-striped table-bordered table-condensed'>" + 
				      "<tr><th>สังกัด</th><td>การประปาส่วนภูมิภาคเขต "+feature.properties.area + "</td></tr>" + 
				      //"<tr><th>ชื่อหน่วยงาน</th><td>" + feature.properties.pwaname + "</td></tr>" + 
				      //"<tr><th>ที่อยู่</th><td>" + feature.properties.pwaaddress + "</td></tr>" +  
				      //"<tr><th>โทรศัพท์</th><td>" + feature.properties.tel + "</td></tr>" +  
				      //"<tr><th>โทรสาร</th><td>" + feature.properties.fax + "</td></tr>" +
				      "<table>";
							*/
				      layer.on({
				        click: function (e) {
				        	/*
				          $("#latlng_m").text(layer.feature.geometry.coordinates[1]+","+layer.feature.geometry.coordinates[0]);
				          $("#feature-title").html("การประปาส่วนภูมิภาคเขต "+feature.properties.area);
				          $("#feature-info").html(content);
				          $("#featureModal").modal("show");		  
						      highlight.clearLayers().addLayer(L.circleMarker([feature.geometry.coordinates[1], feature.geometry.coordinates[0]], highlightStyle));
						      */
				        },
				        mouseover: function (e) {
				        	/*
				           highlight.clearLayers().addLayer(L.circleMarker([feature.geometry.coordinates[1], feature.geometry.coordinates[0]], highlightStyle));
				           */
				        },
				        mouseout: function (e) {
				        	/*
				          highlight.clearLayers();
				          */
				        },


				      });


				    }
				  }
				}).addTo(map);

        //layerControl.addOverlay(points,"<img src='img/office.png' width='17' height='17'>&nbsp;&nbsp;กปภ.เขต",'ชั้นข้อมูล GIS กปภ.');


		var baseLayers = {
		  
		};
		/*
		var baseLayers = {
		  "Google Street": googleStreets,
		  //"Google Terrain": googleTerrain,  
		  "Google Sat": googleSat,
		  "Google Hybrid": googleHybrid
		};
		*/

		var groupedOverlays = {
			/*
		  "ข้อมูลพื้นฐาน": {
		    "<img src='assets/img/zone.png' width='18' height='22'>&nbsp;กปภ.ข.": zone
		  },
		  */
		  
		  "ชั้นข้อมูล GIS กปภ.": {
		    "<img src='img/pwa.png' width='20' height='20'>&nbsp;กปภ.สาขา": points
		  },
		  
		};

		var layerControl = L.control.groupedLayers(baseLayers, groupedOverlays, {
		  collapsed: true, position:'topright'}).addTo(map);

		//var layerControl = L.control.groupedLayers(baseLayers, groupedOverlays, {
		//  collapsed: true, }).addTo(map);



		var mkGroup = new L.FeatureGroup();


	  var camAndroid_='';

	  if( /Android/i.test(navigator.userAgent)){
	    camAndroid_  = ' capture="camera" ';
	    //alert('android');
	  }

		let txt =`
				<ul class="nav nav-pills mb-3" id="pills-tab" role="tablist">
				  <li class="nav-item" role="presentation">
				    <button class="nav-link active" id="pills-home-tab" data-bs-toggle="pill" data-bs-target="#pills-home" type="button" role="tab" aria-controls="pills-home" aria-selected="true">พิกัด</button>
				  </li>
				  <li class="nav-item" role="presentation">
				    <button class="nav-link" id="pills-profile-tab" data-bs-toggle="pill" data-bs-target="#pills-profile" type="button" role="tab" aria-controls="pills-profile" aria-selected="false">ข้อมูลมาตร</button>
				  </li>
				  <li class="nav-item" role="presentation">
				    <button class="nav-link" id="pills-contact-tab" data-bs-toggle="pill" data-bs-target="#pills-contact" type="button" role="tab" aria-controls="pills-contact" aria-selected="false">รูปถ่าย</button>
				  </li>
				</ul>
				<div class="tab-content" id="pills-tabContent">
				  <div class="tab-pane fade show active" id="pills-home" role="tabpanel" aria-labelledby="pills-home-tab">
					  <div class="input-group input-group-sm mb-3">
					  <span class="input-group-text" id="inputGroup-sizing-sm">Lat</span>
					  <input type="text" class="form-control" aria-label="Sizing example input" aria-describedby="inputGroup-sizing-sm" id="geolat">
						</div>
						<div class="input-group input-group-sm mb-3">
						  <span class="input-group-text" id="inputGroup-sizing-sm">Lng</span>
						  <input type="text" class="form-control" aria-label="Sizing example input" aria-describedby="inputGroup-sizing-sm" id="geolng">
						</div>		
					</div>
				  <div class="tab-pane fade" id="pills-profile" role="tabpanel" aria-labelledby="pills-profile-tab">
						<div class="input-group input-group-sm mb-3">
						  <span class="input-group-text" id="inputGroup-sizing-sm">เลขมาตร</span>
						  <input type="text" class="form-control" aria-label="Sizing example input" aria-describedby="inputGroup-sizing-sm" id="meterno">
						</div>
						<div class="input-group input-group-sm mb-3">
						  <span class="input-group-text" id="inputGroup-sizing-sm">บ้านเลขที่</span>
						  <input type="text" class="form-control" aria-label="Sizing example input" aria-describedby="inputGroup-sizing-sm" id="housenum">
						</div>
				  </div>
				  <div class="tab-pane fade" id="pills-contact" role="tabpanel" aria-labelledby="pills-contact-tab">
						<div class="mb-3">
						  <label for="upload_img_meter" class="form-label">อัพโหลดภาพ</label>
						  <input name="upload_img_meter"  class="form-control form-control-sm" id="upload_img_meter" type="file" accept=".jpg, .png, .jpeg, .gif" {{ camAndroid_ }}>
						  <span id="helpFileupload1" class="help-block">*เฉพาะไฟล์นามสกุล jpg, png, gif ขนาดไม่เกิน 1 Mb (แนบได้สูงสุด 1 ไฟล์)</span>
						  </br>
							<div style="width:100%;text-align:center;">
						  <img id="image" style="max-width:100%;text-align:center;max-height:250px;"/>
							</div>
						  </br>
						  <div style="width:100%;text-align:center;">
						  <img src="img/default.png" style="max-width:100px;max-height:100px;" id="imagelocal" />
						  </div>
						</div>

						<div>
				  </div>
				</div>
				
          <div class="modal-footer" style="padding-top: 0;padding-bottom: 0;">
		   			<button type="button" class="btn btn-default btn-sm" id='btnsubmit' style="padding-top: 0;padding-bottom: 0;">บันทึก</button>
            <button type="button" class="btn btn-default btn-sm" style="padding-top: 0;padding-bottom: 0;" onclick="modalMeter.hide();mkGroup.removeFrom(map);">ยกเลิก</button>
          </div>				

			`;


    var modalMeter = L.control.window(map,{
			        	position:'center', // 'top', 'topRight', 'right', 'bottomRight', 'bottom', 'bottomLeft', 'left', 'topLeft'
			        	title:'เพิ่มตำแหน่งมาตรวัดน้ำ',
			        	maxWidth:400,
			        	modal: false, //false
								//visible: true,
			        })
      				//.title()
              .content(txt)
              /*
              .prompt({
              	buttonOK:'ต้องการ',
              	
              	callback:function(){
              		alert('This is called after OK click!')
              	},
              	
              	buttonAction:'ไม่ต้องการ', 
              	
              	action:function(){
              		alert('This is called ACTION button is clicked.!')
              	},
              	
              	buttonCancel:'ยกเลิก'

              })
              */
              //.prompt({buttonOK:'ยกเลิก',callback:function(){alert('This is called after Cancel click!')}})                
							//.prompt({buttonAction:'Action', action:function(){alert('This is called ACTION button is clicked.!')}})  						           //.prompt({buttonOK:'ตกลง',buttonCancel:'ยกเลิก'})
              //.show() //.hide() .close()
              //.show([x,y]) .showOn( [50,50])
              //.enableBtn()
              //.disableBtn()
		



			$('#btnsubmit').click(function(event){
					
      		if($('#geolat').val() == '' || $('#geolng').val() ==''){
      			alert('โปรดระบุตำแหน่ง');
      			return;
      		}
      		else{

						//upload_img_meter(1);

      			console.log( $('#geolat').val(),$('#geolng').val(),$('#housenum').val(),$('#formFileSm').val() )
      			
						$.ajax({
							
               type:'POST',
               url:'https://herokunutty.herokuapp.com/mongodb.php',	
							 				

							 async:false,
							 dataType: 'json',
							 data : {

							 		 act: 'a',
									 lat: $('#geolat').val(), 
									 lng: $('#geolng').val(),
									 meterno: $('#meterno').val(),
									 housenum: $('#housenum').val(),
									 image: $('#formFileSm').val()

							 },
							 //dataType: 'text',
							 //processData: false,
							 //contentType: false,
							 success:function(data){

							 	alert('บันทึกลง mongodb สำเร็จ');
							  console.log(data);
							   //console.log(data[0].status);
							  
							   //if(data[0].status == 'not found'){
									//$('#survey_modal').modal();
									//}
								 
							 }

						});
						
						modalMeter.hide();
						mkGroup.removeFrom(map);
      		}

			});


		$("#geolat, #geolng").keyup(function(event){	
				//console.log($('#geolat').val());
			  //console.log($('#geolng').val());

				try{
			      mkGroup.clearLayers();
			      
			      var Icon = L.icon({
						    iconUrl: 'mymeter.png',
						    iconSize: [30, 30],	//
						   	//iconAnchor:   [25, 50], // point of the icon which will correspond to marker's location					    
						    iconAnchor:   [15, 30], // point of the icon which will correspond to marker's location
						    //popupAnchor:  [25, 40] 
						    //shadowUrl: 'http://leafletjs.com/examples/custom-icons/leaf-shadow.png'
								/*
			                iconSize:     [38, 95], // size of the icon
			                shadowSize:   [50, 64], // size of the shadow
			                iconAnchor:   [22, 94], // point of the icon which will correspond to marker's location
			                shadowAnchor: [4, 62],  // the same for the shadow
			                popupAnchor:  [-3, -76] // point from which the popup should open relative to the iconAnchor

			                iconSize:     [38, 95], // size of the icon
			                shadowSize:   [50, 64], // size of the shadow
			                iconAnchor:   [22, 94], // point of the icon which will correspond to marker's location
			                shadowAnchor: [4, 62],  // the same for the shadow
			                popupAnchor:  [-3, -76] // point from which the popup should open relative to the iconAnchor
			          */
						})
			      var marker = L.marker( [parseFloat($('#geolat').val()),parseFloat($('#geolng').val())] , {icon: Icon});
			      marker.bindPopup( "Lat: "+parseFloat($('#geolat').val())+", </br>Lng: "+parseFloat($('#geolng').val())+"<br><a style='text-align:center;cursor:pointer;' onclick='mkGroup.removeFrom(map)'>ลบ</a>");
				   

						//var marker = L.marker( [parseFloat($('#geolat').val()),parseFloat($('#geolng').val())]);

			      //var marker = L.marker(e.latlng);
			      mkGroup.addLayer(marker);
			      mkGroup.addTo(map);
						map.setView([parseFloat($('#geolat').val()), parseFloat($('#geolng').val())], 13.00);

			      marker.dragging.enable();

						marker.on('dragend', function(e) {
							//alert('wow');
							//console.log(e.target._latlng.lat);
							$('#geolat').val(e.target._latlng.lat);
			  			$('#geolng').val(e.target._latlng.lng);

			  			marker.bindPopup( "Lat: "+parseFloat($('#geolat').val())+", </br>Lng: "+parseFloat($('#geolng').val())+"<br><a style='text-align:center;cursor:pointer;' onclick='mkGroup.removeFrom(map)'>ลบ</a>");

				   		//map.setView([e.target._latlng.lat, e.target._latlng.lng], 21.25);

						});
						//console.log(e.latlng.lat);

			  }
			  catch(error){
			  		//console.log(error.message);
			  }


				/*
				var check = valid_search_form();
				if (check==true){
				   if(event.keyCode == 13){
						search_custcode();
					}
				}
				*/
		});	

		chksizelocalstorage();
		function chksizelocalstorage(){

				//เช็คขนาดไฟล์ localstorage
				//var _lsTotal=0,_xLen,_x;for(_x in localStorage){ if(!localStorage.hasOwnProperty(_x)){continue;} _xLen= ((localStorage[_x].length + _x.length)* 2);_lsTotal+=_xLen; console.log(_x.substr(0,50)+" = "+ (_xLen/1024).toFixed(2)+" KB")};

				var _lsTotal = 0,
	    			_xLen, _x;
				for (_x in localStorage) {
				    if (!localStorage.hasOwnProperty(_x)) {
				        continue;
				    }
				    _xLen = ((localStorage[_x].length + _x.length) * 2);
				    _lsTotal += _xLen;
				    console.log(_x.substr(0, 50) + " = " + (_xLen / 1024).toFixed(2) + " KB")
				};
				//_lsTotal = 1200000;
				//_lsTotal = 3000000;
				//_lsTotal = 5000000;
				//_lsTotal = 9000000;		
				//_lsTotal = 10500000;
				console.log("Total = " + (_lsTotal / 1024).toFixed(2) + " KB");
				console.log("Total = " + addCommasmb((_lsTotal / 1024).toFixed(2)));

				//$('#localstorage').html((_lsTotal / 1024).toFixed(2) + " KB");
				$('#localstorage').html(addCommasmb((_lsTotal / 1024).toFixed(2)));
				$('div.progress-bar:first-child').html( parseInt((_lsTotal / 1024)/10240*100)+'%');
				$('div.progress-bar:first-child').attr('aria-valuenow', parseInt((_lsTotal / 1024)/10240*100) );
				$('div.progress-bar:first-child').css('width', parseInt((_lsTotal / 1024)/10240*100)+'%');			
			
				if(parseInt( (_lsTotal / 1024)/10240*100) == 0){
					$('div.progress-bar:first-child').addClass('bg-success');
					$('div.progress-bar:first-child').html('');
					//$('div.progress-bar:first-child').html(((_lsTotal / 1024)/10240*100).toFixed(2)+'%');
					$('div.progress-bar:first-child').css('width',parseFloat( (_lsTotal / 1024)/10240*100).toFixed(2)+'%');		//default
					//$('div.progress-bar:first-child').css('background','#e9ecef');			
					//$('div.progress-bar:first-child').css('color','#000000');	
					$('div.progress-bar:last-child').html(((_lsTotal / 1024)/10240*100).toFixed(2)+'%');
					$('div.progress-bar:last-child').css('width','80%');								
				}
				else if(parseInt( (_lsTotal / 1024)/10240*100) <= 20){
					$('div.progress-bar:first-child').addClass('bg-success');
					$('div.progress-bar:first-child').html('');
					//$('div.progress-bar:first-child').html(((_lsTotal / 1024)/10240*100).toFixed(2)+'%');
					$('div.progress-bar:first-child').css('width',parseFloat( (_lsTotal / 1024)/10240*100).toFixed(2)+'%');		//default
					//$('div.progress-first-child').css('background','#e9ecef');			
					//$('div.progress-bar:first-child').css('color','#000000');	
					$('div.progress-bar:last-child').html(((_lsTotal / 1024)/10240*100).toFixed(2)+'%');		
					$('div.progress-bar:last-child').css('width','80%');											
				}
				else if(parseInt( (_lsTotal / 1024)/10240*100) >= 100){
					$('div.progress-bar:first-child').addClass('bg-danger');
					$('div.progress-bar:first-child').addClass('progress-bar-striped');
					$('div.progress-bar:first-child').addClass('progress-bar-animated');
					//$('div.progress-bar:last-child').html( '100%');
					$('div.progress-bar:last-child').html('');	
				}				
				else if(parseInt( (_lsTotal / 1024)/10240*100) >= 90){
					$('div.progress-bar:first-child').addClass('bg-danger');
					$('div.progress-bar:first-child').addClass('progress-bar-striped');
					$('div.progress-bar:first-child').addClass('progress-bar-animated');
					$('div.progress-bar:last-child').html('');									
				}
				else if(parseInt( (_lsTotal / 1024)/10240*100) >= 80){
					$('div.progress-bar:first-child').addClass('bg-warning');
					$('div.progress-bar:first-child').addClass('progress-bar-striped');
					$('div.progress-bar:first-child').addClass('progress-bar-animated');
					$('div.progress-bar:last-child').html('');									
				}			
				else{
					$('div.progress-bar:first-child').addClass('bg-primary');
					$('div.progress-bar:first-child').addClass('progress-bar-striped');
					$('div.progress-bar:first-child').addClass('progress-bar-animated');
					$('div.progress-bar:last-child').html('');									
				}
				
				/*
				var _lsTotal = 0,
	    			_xLen, _x;
				for (_x in localStorage) {
				    if (!localStorage.hasOwnProperty(_x)) {
				        continue;
				    }
				    _xLen = ((localStorage[_x].length + _x.length) * 2);
				    _lsTotal += _xLen;
				    console.log(_x.substr(0, 50) + " = " + (_xLen / 1024).toFixed(2) + " KB")
				};
				console.log("Total = " + (_lsTotal / 1024).toFixed(2) + " KB");
				*/
				/*
					var localStorageSpace = function(){
			        var allStrings = '';
			        for(var key in window.localStorage){
			            if(window.localStorage.hasOwnProperty(key)){
			                allStrings += window.localStorage[key];
			            }
			        }
			        return allStrings ? 3 + ((allStrings.length*16)/(8*1024)) + ' KB' : 'Empty (0 KB)';
			    };
				*/
				
		}


		document.getElementById('upload_img_meter').onchange = function () {

		  var src = URL.createObjectURL(this.files[0])
		  document.getElementById('image').src = src;

			setTimeout(function(){ 
						getBase64ImageResize(document.getElementById('image'));
			}, 1000);
			
		}

		function img_to_localstorage(){
			//แปลงเป็นbase64
			var previewimg = document.getElementById('image');
			var imgData = getBase64Image(previewimg);
			localStorage.setItem("imgData", imgData);
		}
		function localstorage_to_img(){
			//เอารูป base64 มาแสดง
			//<img src="" id="imagelocal" />
			var dataImage = localStorage.getItem('imgData');
			var showImg = document.getElementById('imagelocal');
			showImg.src = "data:image/png;base64," + dataImage;
		}

		function getBase64Image(img) {
		    var canvas = document.createElement("canvas");
		    canvas.width = img.width;
		    canvas.height = img.height;

		    var ctx = canvas.getContext("2d");
		    ctx.drawImage(img, 0, 0);

		    var dataURL = canvas.toDataURL("image/png");

		    return dataURL.replace(/^data:image\/(png|jpg);base64,/, "");

				//var dataURL = getDataURL(document.querySelector('#myimg'));
		    /*
				var _URL = window.URL || window.webkitURL;
				$("#file-input").change(function(e) {
				    var file, img;
				    if ((file = this.files[0])) {
				        img = new Image();
				        img.onload = function() {
				            $("#file-h").val(this.height);
				            $("#file-w").val(this.width);
				        };
				        img.onerror = function() {
				            alert( "not a valid file: " + file.type);
				        };
				        img.src = _URL.createObjectURL(file);
				    }
				});

		    var canvas = document.createElement("canvas");
		    	canvas.width = img.width;
		    	canvas.height = img.height;
		        var canvas = document.createElement("canvas");
    				canvas.width = $("#file-w").val();
    				canvas.height = $("#file-h").val();
				*/
		}
		function getBase64ImageResize(img) {
			/*
			alert(img);
				if(!img || img==null){
					img = document.getElementById('image');
				}
				*/
		    var canvas = document.createElement("canvas");
		    //canvas.width = img.width;
		    //canvas.height = img.height;

				canvas.width = 64; // target width
				canvas.height = 64; // target height

		    var ctx = canvas.getContext("2d");
		    //ctx.drawImage(img, 0, 0);
				ctx.drawImage(img, 0, 0 ,canvas.width, canvas.height);
		    /*
		    ctx.drawImage(img, 
		        0, 0, img.width, img.height, 
		        0, 0, canvas.width, canvas.height
		    );
				*/
		    // create a new base64 encoding
		    var resampledImage = new Image();
		    resampledImage.src = canvas.toDataURL();
		    document.getElementById("resampled").appendChild(resampledImage);
				//getBase64ImageResize(document.getElementById('image'));
		    /* //example
		    image.src = "data:image/png; base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAMAAABg3Am1AAABaFBMVEVMoUNNoURNokROokVPokZQo0dRpEhSpElTpUpUpUtVpk1Wpk1Xp09ZqFBZqFFaqFJbqVJbqVNdqlVeqlVeq1Zgq1hgrFhirFpirVtlrl5mr15nr2BpsGFqsWNssmRus2dvs2hwtGlxtGlytWtztWx4uHF5uXJ6uXR+u3d/vHiAvHqBvXqCvXyDvn2Evn6HwIGMw4aPxImRxYuUx46Vx5CWyJGbypacy5egzZuizp2kz5+kz6Cm0KGn0aKp0qSp0qWs1Kiu1Kmw1ayy1q602LC12LG627e83Lm+3bvF4cPI4sXJ48bK48jL5MjM5MrN5cvP5szQ5s7R58/S59DU6dLV6dPa7Nnf7t7g79/h79/i8OHj8OLk8ePm8uXn8ubp9Ojq9Onr9ers9evt9ezu9u3v9+7w9+/x+PDy+PHy+PL0+fP0+fT1+vX2+vX3+/f4+/j5/Pj5/Pn6/Pr7/fv9/v3+/v7+//7////VxbUKAAABVElEQVR4Ae3L65cKcQDH4e9YYe2utMnFsuu+rCyFKDVyKSTG/X6RVO5Ums+/r3HQOZz5zcyb7U3P+0drbcLKVRVF/DacVQSbnkL/oCJY+Axv4orgpAvOlMJYvJXU0GWgqBBSDd4ekhR7CINjClYGellJ21rwfocCWYUBcDUmHfkBj2IKlv4EPEhI54GKQlh4DjQOyKoBp2Syf1qemZtAN6PZV/Btr/xNdz5cnNeQVXKBK+uXvsNd+TsH9K4taujEF+D+1iw35uTP7gK4zlFL2vMCeL1vWUaJC208jzMbNFsHzijIxtPP8LzLz62z3UsKwTp+D8/Xyq7DUzKZ36nflq73AXpbZFSi49irKXm2lz9CVWZ3+KVVL6aT0ubcy90ye8JIs1ZYiStIYqVQa/JXXr4A/ZFMF+stPMsSYAojqVXbac+EDiPmwD/GH/431mAwhmA28RMGFbXqgVfHnwAAAABJRU5ErkJggg==";
				*/
				
		    //var dataURL = canvas.toDataURL("image/png");
		    //return dataURL.replace(/^data:image\/(png|jpg|gif|jpeg);base64,/, "");
				
		}



		/*
		// get user's uploaded image
		const imgPath = document.querySelector('input[type=file]').files[0];
		const reader = new FileReader();

		reader.addEventListener("load", function () {
		    // convert image file to base64 string and save to localStorage
		    localStorage.setItem("image", reader.result);
		}, false);

		if (imgPath) {
		    reader.readAsDataURL(imgPath);
		}
		let img = document.getElementById('image');
		img.src = localStorage.getItem('image');
		*/

		/*
		document.getElementById('file').addEventListener('change', (e) => {
		  const file = e.target.files[0];
		  const reader = new FileReader();
		  reader.onloadend = () => {
		    // convert file to base64 String
		    const base64String = reader.result.replace('data:', '').replace(/^.+,/, '');
		    // store file
		    localStorage.setItem('wallpaper', base64String);
		    // display image
		    document.body.style.background = `url(data:image/png;base64,${base64String})`;
		  };
		  reader.readAsDataURL(file);
		});
		*/

		function readURL(input) 
		{
		    document.getElementById("bannerImg").style.display = "block";

		    if (input.files && input.files[0]) {
		        var reader = new FileReader();

		        reader.onload = function (e) {
		            document.getElementById('bannerImg').src =  e.target.result;
		        }

		        reader.readAsDataURL(input.files[0]);
		    }
		}

		function upload_img_meter(id){
			act ='image';
			var form_data = new FormData();
			var files = $('#upload_img_meter')[0].files;

			for (var i = 0; i < files.length; i++) {
				form_data.append("upload_img_meter[]", files[i]);
			}	
			//alert(ref_no);
			form_data.append("act", act);
			form_data.append("id", id);

			$.ajax({
				url: 'upload_img_meter.php', // point to server-side PHP script 
				type: 'POST',
				async:false, //= Code paused. (Other code waiting for this to finish.)
				//async:true, //= Code continued. (Nothing gets paused. Other code is not waiting.)
				dataType: 'text', // what to expect back from the PHP script
				data: form_data,

				cache: false,
				contentType: false,
				processData: false,

				success: function (response) {
					//$('#msg').html(response); // display success response from the PHP script
					localStorage.setItem('upload_img_meter',response);
					//upload_img_thumbnail(localStorage.getItem('act'));
					
					return response;
				},
				error: function (response) {
					//$('#msg').html(response); // display error response from the PHP script
					localStorage.setItem('upload_img_meter','');
					return "";
				}

			});

		}


		function openModal(){

			$('#geolat').val(map.getCenter().lat);
			$('#geolng').val(map.getCenter().lng);

				try{
			      mkGroup.clearLayers();
			      
			      var Icon = L.icon({
						    iconUrl: 'mymeter.png',
						    iconSize: [30, 30],	//
						   	//iconAnchor:   [25, 50], // point of the icon which will correspond to marker's location					    
						    iconAnchor:   [15, 30], // point of the icon which will correspond to marker's location
						    //popupAnchor:  [25, 40] 
						    //shadowUrl: 'http://leafletjs.com/examples/custom-icons/leaf-shadow.png'
								/*
			                iconSize:     [38, 95], // size of the icon
			                shadowSize:   [50, 64], // size of the shadow
			                iconAnchor:   [22, 94], // point of the icon which will correspond to marker's location
			                shadowAnchor: [4, 62],  // the same for the shadow
			                popupAnchor:  [-3, -76] // point from which the popup should open relative to the iconAnchor

			                iconSize:     [38, 95], // size of the icon
			                shadowSize:   [50, 64], // size of the shadow
			                iconAnchor:   [22, 94], // point of the icon which will correspond to marker's location
			                shadowAnchor: [4, 62],  // the same for the shadow
			                popupAnchor:  [-3, -76] // point from which the popup should open relative to the iconAnchor
			          */
						})
			      var marker = L.marker( [parseFloat($('#geolat').val()),parseFloat($('#geolng').val())] , {icon: Icon});
			      marker.bindPopup( "Lat: "+parseFloat($('#geolat').val())+", </br>Lng: "+parseFloat($('#geolng').val())+"<br><a style='text-align:center;cursor:pointer;' onclick='mkGroup.removeFrom(map)'>ลบ</a>");
				   

						//var marker = L.marker( [parseFloat($('#geolat').val()),parseFloat($('#geolng').val())]);

			      //var marker = L.marker(e.latlng);
			      mkGroup.addLayer(marker);
			      mkGroup.addTo(map);

			      marker.dragging.enable();

						marker.on('dragend', function(e) {
							//alert('wow');
							//console.log(e.target._latlng.lat);
							$('#geolat').val(e.target._latlng.lat);
			  			$('#geolng').val(e.target._latlng.lng);

			  			marker.bindPopup( "Lat: "+parseFloat($('#geolat').val())+", </br>Lng: "+parseFloat($('#geolng').val())+"<br><a style='text-align:center;cursor:pointer;' onclick='mkGroup.removeFrom(map)'>ลบ</a>");

				   		//map.setView([e.target._latlng.lat, e.target._latlng.lng], 21.25);
						});
						//console.log(e.latlng.lat);

			  }
			  catch(error){
			  		//console.log(error.message);
			  }

			//map.getCenter()		
			//map.getCenter().toString()

			modalMeter.show();
		}

		function saveToFile(content, filename, type) {

					if(type==1){
						type ='.json';
					}
					else if(type==2){
						type='.geojson';
					}
		      var file = filename + type;
		      saveAs(new File([JSON.stringify(content)], file, {
		        type: "text/plain;charset=utf-8"
		      }), file);
		}


		function exportgeojson(name,type){

				console.log(this.bookmarkctrl._data);

			 	var tmp_geojson = {
			      "type": "FeatureCollection",
			      "features": []
			  };


			  if(this.bookmarkctrl._data.length >0){


					$.each(this.bookmarkctrl._data, function() {

							if(!this.imgbase64){
								this.imgbase64 = '';
							}
							var subfeature = 				
							{
							  "type": "Feature",
							  "geometry": {
							    "type": "Point",
							    "coordinates": [this.latlng[1], this.latlng[0]]
							  },
							  "properties": {
							  	"id": this.id,
							    "name": this.name,
							    "zoom": this.zoom,
							    "imgbase64": this.imgbase64
							  }
							};
							tmp_geojson.features.push(subfeature);

					});
					saveToFile(tmp_geojson, name, type);

			  }


			  	/*
				 	var freeBus = {
				      "type": "FeatureCollection",
				      "features": [

				      	{
				          "type": "Feature",
				          "geometry": {
				            "type": "LineString",
				            "coordinates": [
				              [100.00341892242432, 12.75383843460583],
				              [100.0008225440979, 12.751891803969535]
				            ]
				          },
				          "properties": {
				            "popupContent": "This is free bus that will take you across downtown.",
				          },
				          "id": 1
				        },

				        {
				          "type": "Feature",
				          "geometry": {
				            "type": "LineString",
				            "coordinates": [
				              [100.0008225440979, 12.751891803969535],
				              [100.99820470809937, 12.74979664004068]
				            ]
				          },
				          "properties": {
				            "popupContent": "This is free bus that will take you across downtown.",
				          },
				          "id": 2
				        },

				        {
				          "type": "Feature",
				          "geometry": {
				            "type": "LineString",
				            "coordinates": [
				              [100.99820470809937, 12.74979664004068],
				              [100.98689651489258, 12.741052354709055]
				            ]
				          },
				          "properties": {
				            "popupContent": "This is free bus that will take you across downtown.",
				          },
				          "id": 3
				        }

				      ]
				  };
					*/
			  	/*
					if(!pointImport._leaflet_id){
						alert('ไม่พบชั้นข้อมูล โปรดนำเข้าข้อมูลก่อนครับ');
					}
					else{
						saveToFile(exportfile, 'intersect');
					}
					*/

					/*
				    if(exportfile != null||exportfile != undefined){
						saveToFile(exportfile, 'intersect');
				    }
				    else{
				    	//var layer = L.geoJson(freeBus).addTo(map);
				    	//saveToFile(layer.toGeoJSON(), 'test');
				    	saveToFile(freeBus, 'test');
				    }
					*/
					//saveToFile(freeBus, 'test');

		}

    var availableTags = [
         {label: "55220154558", value: "id1"},
         {label: "55220414584", value: "id2"},
         {label: "55220112451", value: "id3"},
         {label: "55220689987", value: "id4"}
    ];  


		$('#btnsearch').autocomplete({
		  source: availableTags,
		  /*
		  focus: function(event, ui) {
		    $(this).val(ui.item.label);
		    return false;
		  },
		  */
		  select: function(event, ui) {
		    //$('#hidCidade').val(ui.item.value);
		    $(this).val(ui.item.label);
		    alert(ui.item.label+','+ui.item.value);
		    return false;
		  }
		});

		function getmongo(type){

						$.ajax({
							
							 type:'GET',
							 url:'https://herokunutty.herokuapp.com/mongodb.php?act=qm',
							 crossDomain: true,

							 async:false,
							 dataType: 'json',
							 data : {
							 		 act: 'qm'
							 },
							 //dataType: 'text',
							 //processData: false,
							 //contentType: false,
							 success:function(data){
							  //console.log(data);

							  let markersCluster = L.markerClusterGroup({
							  	 disableClusteringAtZoom: 17,
							  	/*
							  	maxClusterRadius: 120,
									spiderfyOnMaxZoom: false,
									showCoverageOnHover: false,
									zoomToBoundsOnClick: false,
									removeOutsideVisibleBounds:true,
									animate:true,
									iconCreateFunction: function(cluster) {
										return L.divIcon({ html: '<b>' + cluster.getChildCount() + '</b>' });
									},
									spiderfyShapePositions: function(count, centerPt) {
			                var distanceFromCenter = 35,
			                    markerDistance = 45,
			                    lineLength = markerDistance * (count - 1),
			                    lineStart = centerPt.y - lineLength / 2,
			                    res = [],
			                    i;

			                res.length = count;

			                for (i = count - 1; i >= 0; i--) {
			                    res[i] = new Point(centerPt.x + distanceFromCenter, lineStart + markerDistance * i);
			                }

			                return res;
			            },
									*/

								});

							  let gMk = new L.featureGroup();

								$.each(data['documents'],function(){	

									var iconMaker = L.icon({
									  iconUrl: 'mymeter.png',
									  iconSize: [30, 30], // size of the icon
							      //iconAnchor: [5, 5], // point of the icon which will correspond to marker's location
							      //popupAnchor: [0, -5] // point from which the popup should open relative to the iconAnchor'
									});

									let mkmeter = new L.marker([this.lat,this.lng],{title: "เลขมาตร: "+this.meterno, icon: iconMaker });
									//gMk.addLayer(mkmeter);
									//mkmeter.bindPopup(title);
									markersCluster.addLayer(mkmeter);
								});

								//map.fitBounds(gMk.getBounds());
								//map.addLayer(gMk);

								map.fitBounds(markersCluster.getBounds());
								map.addLayer(markersCluster);

								markersCluster.on('click', function (a) {
									console.log('marker ' + a.layer);
								});

								markersCluster.on('clusterclick', function (a) {
									// a.layer is actually a cluster
									console.log('cluster ' + a.layer.getAllChildMarkers().length);
									//map.addLayer(L.polygon(a.layer.getConvexHull()));
									//a.layer.zoomToBounds({padding: [20, 20]});
									console.log(a.layer.getAllChildMarkers());
									/*
									var visibleOne = markersCluster.getVisibleParent(gMk);
									console.log(visibleOne.getLatLng());
									*/

								});



							 }

						});
			
		}



      function addCommas(nStr) {
          nStr += '';
          var x = nStr.split('.');
          var x1 = x[0];
          var x2 = x.length > 1 ? '.' + x[1] : '';
          var rgx = /(\d+)(\d{3})/;
          while (rgx.test(x1)) {
              x1 = x1.replace(rgx, '$1' + ',' + '$2');
          }
          return x1 + x2;
      }
      function addCommasmb(nStr) {

        nStr += '';
        var x = nStr.split('.');
        var x1 = x[0];
        var x2 = x.length > 1 ? '.' + x[1] : '';
        var rgx = /(\d+)(\d{3})/;
        var rgxmore = /(\d+)(\d{6})/;
        if(rgx.test(x1) == true){ // more999

          if(rgxmore.test(x1) == true){
            //addCommas(x1)
            while (rgx.test(x1)) {
                x1 = x1.replace(rgx, '$1' + ',' + '$2');
            }
            x1 = x1.split(',');
            var sum='';
            for ($i=0; $i<x1.length; $i++){
              if($i == x1.length-2){
                //console.log(x1[$i]);
                sum +=x1[$i]+'.';
              }              
              else if($i == x1.length-1){
                //console.log(x1[$i]);
                sum += x1[$i].substring(0,2);
              }
              else{
                //console.log(x1[$i]);
                sum +=x1[$i]+',';
              }
            }

            return sum +' MB'; 
          }
          else{
            while (rgx.test(x1)) {
                x1 = x1.replace(rgx, '$1' + ',' + '$2');
            }
            //console.log(x1);
            //console.log(x2);
            return parseFloat(x1.replace(',', '.')).toFixed(2) +' MB'; 
          }
          

        }
        else{

          while (rgx.test(x1)) {
              x1 = x1.replace(rgx, '$1' + ',' + '$2');
          }
          //console.log(x1);หลักหน่วยเมตร
          //console.log(x2);//ทศนิยม
          return parseFloat(x1 + x2).toFixed(2)+' KB';

        }

      }

		(function() {

		}());



		/*
		/// VERTICAL

		new L.cascadeButtons([
		    {icon: 'fas fa-home', ignoreActiveState:true , command: () =>{console.log('test') }},
		    {icon: 'fas fa-home', items:[
		        {icon: 'fas fa-home', command: () =>{console.log('hola')}},
		        {icon: 'fas fa-home', command: () =>{console.log('hola')}},
		        {icon: 'fas fa-globe', command: () =>{console.log('hola')}},
		    ]},
		    {icon: 'fas fa-home', items: [
		        {icon: 'fas fa-home', command: () =>{console.log('hola')}},
		        {icon: 'fas fa-globe', command: () =>{console.log('hola')}},
		    ]},
		], {position:'topleft', direction:'vertical'}).addTo(map);

		new L.cascadeButtons([
		    {icon: 'fas fa-home', ignoreActiveState:true , command: () =>{console.log('test') }},
		    {icon: 'fas fa-home', items:[
		        {icon: 'fas fa-home', command: () =>{console.log('hola')}},
		        {icon: 'fas fa-home', command: () =>{console.log('hola')}},
		        {icon: 'fas fa-globe', command: () =>{console.log('hola')}},
		    ]},
		    {icon: 'fas fa-home', items: [
		        {icon: 'fas fa-home', command: () =>{console.log('hola')}},
		        {icon: 'fas fa-globe', command: () =>{console.log('hola')}},
		    ]},
		], {position:'bottomright', direction:'vertical'}).addTo(map);

		new L.cascadeButtons([
		    {icon: 'fas fa-home', ignoreActiveState:true , command: () =>{console.log('test') }},
		    {icon: 'fas fa-home', items:[
		        {icon: 'fas fa-home', command: () =>{console.log('hola')}},
		        {icon: 'fas fa-home', command: () =>{console.log('hola')}},
		        {icon: 'fas fa-globe', command: () =>{console.log('hola')}},
		    ]},
		    {icon: 'fas fa-home', items: [
		        {icon: 'fas fa-home', command: () =>{console.log('hola')}},
		        {icon: 'fas fa-globe', command: () =>{console.log('hola')}},
		    ]},
		], {position:'topright', direction:'vertical'}).addTo(map);

		new L.cascadeButtons([
		    {icon: 'fas fa-home', ignoreActiveState:true , command: () =>{console.log('test') }},
		    {icon: 'fas fa-home', items:[
		        {icon: 'fas fa-home', command: () =>{console.log('hola')}},
		        {icon: 'fas fa-home', command: () =>{console.log('hola')}},
		        {icon: 'fas fa-globe', command: () =>{console.log('hola')}},
		    ]},
		    {icon: 'fas fa-home', items: [
		        {icon: 'fas fa-home', command: () =>{console.log('hola')}},
		        {icon: 'fas fa-globe', command: () =>{console.log('hola')}},
		    ]},
		], {position:'bottomleft', direction:'vertical'}).addTo(map);


		//// HORIZONTAL

		new L.cascadeButtons([
		    {icon: 'fas fa-home', ignoreActiveState:true , command: () =>{console.log('test') }},
		    {icon: 'fas fa-home', items:[
		        {icon: 'fas fa-home', command: () =>{console.log('hola')}},
		        {icon: 'fas fa-home', command: () =>{console.log('hola')}},
		        {icon: 'fas fa-globe', command: () =>{console.log('hola')}},
		    ]},
		    {icon: 'fas fa-home', items: [
		        {icon: 'fas fa-home', command: () =>{console.log('hola')}},
		        {icon: 'fas fa-globe', command: () =>{console.log('hola')}},
		    ]},
		], {position:'topleft', direction:'horizontal'}).addTo(map);

		new L.cascadeButtons([
		    {icon: 'fas fa-home', ignoreActiveState:true , command: () =>{console.log('test') }},
		    {icon: 'fas fa-home', items:[
		        {icon: 'fas fa-home', command: () =>{console.log('hola')}},
		        {icon: 'fas fa-home', command: () =>{console.log('hola')}},
		        {icon: 'fas fa-globe', command: () =>{console.log('hola')}},
		    ]},
		    {icon: 'fas fa-home', items: [
		        {icon: 'fas fa-home', command: () =>{console.log('hola')}},
		        {icon: 'fas fa-globe', command: () =>{console.log('hola')}},
		    ]},
		], {position:'bottomright', direction:'horizontal'}).addTo(map);

		new L.cascadeButtons([
		    {icon: 'fas fa-home', ignoreActiveState:true , command: () =>{console.log('test') }},
		    {icon: 'fas fa-home', items:[
		        {icon: 'fas fa-home', command: () =>{console.log('hola')}},
		        {icon: 'fas fa-home', command: () =>{console.log('hola')}},
		        {icon: 'fas fa-globe', command: () =>{console.log('hola')}},
		    ]},
		    {icon: 'fas fa-home', items: [
		        {icon: 'fas fa-home', command: () =>{console.log('hola')}},
		        {icon: 'fas fa-globe', command: () =>{console.log('hola')}},
		    ]},
		], {position:'topright', direction:'horizontal'}).addTo(map);

		new L.cascadeButtons([
		    {icon: 'fas fa-home', ignoreActiveState:true , command: () =>{console.log('test') }},
		    {icon: 'fas fa-home', items:[
		        {icon: 'fas fa-home', command: () =>{console.log('hola')}},
		        {icon: 'fas fa-home', command: () =>{console.log('hola')}},
		        {icon: 'fas fa-globe', command: () =>{console.log('hola')}},
		    ]},
		    {icon: 'fas fa-home', items: [
		        {icon: 'fas fa-home', command: () =>{console.log('hola')}},
		        {icon: 'fas fa-globe', command: () =>{console.log('hola')}},
		    ]},
		], {position:'bottomleft', direction:'horizontal'}).addTo(map);
		*/




		
		//map.MapPaint.disable();
		//map.MapPaint.enable();

	  var mappaintctrl = new MapPaint.SwitchControl({position: 'bottomright'}).addTo(map);

	  //map.addControl(new MapPaint.SwitchControl({position: 'bottomright'}));
	  var overlaypaint = [];
	  map.MapPaint.saveMethod = function(image, bounds) {
	   		var c_paint=overlaypaint.length;
	   		console.log('save paint: ' + overlaypaint.length );
	  		overlaypaint[c_paint] = new L.imageOverlay(image, bounds).addTo(this._map);
	     //layerControl.removeLayer(pipe_all);
	      //layerControl._update();
	      layerControl.addOverlay(overlaypaint[c_paint] ,'Paint '+ c_paint +'<i title="ลบ" class="fa fa-trash" aria-hidden="true" style="margin-left:2px;border-radius: 5px;cursor: pointer;color: red;border: 1px solid #ff92928c;padding: 3px;" onclick="overlaypaint['+ c_paint +'] .removeFrom(map);map.removeLayer(overlaypaint['+ c_paint +'] );layerControl.removeLayer(overlaypaint['+ c_paint +'] );layerControl._update();"></i>','ภาพวาด');
	      layerControl._update();
	  }

	  //$( ".mappaint-control.leaflet-control" ).draggable();

		map.on("zoomstart", function(e) {
		  if(zoomLock){
		  	//console.log('zoom disabled');
		    throw 'ไม่สามารถซูมแผนที่ได้ โปรดปิดฟังก์ชันวาดรูป';
		  }
		});		

	
		var bookmarkctrl = new L.Control.Bookmarks({
			position: 'bottomright',
		    name: 'fav-survey', // defaults to 'leaflet-bookmarks'
		    localStorage: true // if you want to use local variable for storage
		}).addTo(map);
		//$('div.leaflet-bar.leaflet-bookmarks-control.leaflet-control').attr('title','Bookmarks');
		//$('div.leaflet-bar.leaflet-bookmarks-control.leaflet-control').css('z-index','1');
		//$('div.bookmarks-container.list-with-button').append('<div class="add-bookmark-button"><span class="plus">-</span><span class="content">ลบจุด Bookmark</span></div>');
		//bookmarkControl._storage.getItem('bm', callback);
		//bookmarkControl._storage.setItem(key, value, callback);
		//bookmarkControl._storage.removeItem(key, callback);
		//bookmarkControl._storage.getAllItems(callback);	
		



        var layers = [];
        for (var providerId in providers) {
            layers.push(providers[providerId]);
        }
        /*
        layers.push({
            layer: {
                onAdd: function() {},
                onRemove: function() {}
            },
            title: 'empty'
        })
		*/
        var ctrl = L.control.iconLayers(layers).addTo(map);
		



		/*
		L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
			maxZoom: 19,
			attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, '
		}).addTo(map);
		
	    L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', {
	      maxZoom: 15,
	      attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>'
	    }).addTo(map);
		*/


		/*
		function onLocationFound(e) {
			var radius = e.accuracy / 2;

			L.marker(e.latlng).addTo(map)
				.bindPopup("You are within " + radius + " meters from this point").openPopup();

			L.circle(e.latlng, radius).addTo(map);
		}

		function onLocationError(e) {
			alert(e.message);
		}

		map.on('locationfound', onLocationFound);
		map.on('locationerror', onLocationError);

		map.locate({setView: true, maxZoom: 16});
		*/
		

		/*
	
		L.tileLayer('http://{s}.tile.stamen.com/watercolor/{z}/{x}/{y}.jpg', {
			subdomains: ['a', 'b', 'c', 'd'],
			minZoom: 3,
		    detectRetina: true,
		    maxNativeZoom: 17
		}).addTo(map);

		*/

		/*
    var marker = L.marker([13,101],{title:"Click to show window." }).addTo(map);
    var win
    marker.on('click',function(){
        win =  L.control.window(map,{
				        	position:'center', // 'top', 'topRight', 'right', 'bottomRight', 'bottom', 'bottomLeft', 'left', 'topLeft'
				        	title:'Hello world!',
				        	maxWidth:400,
				        	modal: true, //false
									//visible: true,
				        })
        				//.title()
                .content('ทดสอบ Modal.<a onclick="moveModal(win)">Move</a>')
                .prompt({buttonOK:'ต้องการ',callback:function(){alert('This is called after OK click!')},buttonAction:'ไม่ต้องการ', action:function(){alert('This is called ACTION button is clicked.!')},buttonCancel:'ยกเลิก'})
                //.prompt({buttonOK:'ยกเลิก',callback:function(){alert('This is called after Cancel click!')}})                
								//.prompt({buttonAction:'Action', action:function(){alert('This is called ACTION button is clicked.!')}})  						           //.prompt({buttonOK:'ตกลง',buttonCancel:'ยกเลิก'})

                .show() //.hide() .close()
                //.show([x,y]) .showOn( [50,50])
                //.enableBtn()
                //.disableBtn()                
    });
    function moveModal(){
    	console.log(win)
			win.options.modal = false;
			win.show()
    }
		*/
	</script>


	<script>
		/*
		draw();

		function draw() {

		    var canvas = document.getElementById('idCanvas');
		    var context = canvas.getContext('2d');

		    var imageObj = new Image();


		  imageObj.onload = function() {
		    context.drawImage(imageObj, 0, 0);
		    context.font = "40px Calibri";
		    context.fillStyle = "red";
		    context.fillText("My TEXT!", 50, 300);

		    var canvas = document.getElementById('idCanvas');
		    var dataURL = canvas.toDataURL();

		    alert(dataURL);
		  }
		imageObj.setAttribute('crossOrigin', 'anonymous');
		imageObj.src = "http://lorempixel.com/400/200/";
		};
		*/

	</script>

	<!--
	<script src="leaflet/motion/dist/leaflet.motion.min.js"></script>
	<script>
		/*
		L.motion.polyline([], options, motionOptions, markerOptions).addTo(map); //  as L.polyline
		L.motion.polygon([], options, motionOptions, markerOptions).addTo(map); //  as L.polygon
		L.motion.group([], options).addTo(map); //  as L.featureGroup - to run all animation at same time
		L.motion.seq([], options).addTo(map); //  as L.featureGroup - to setup seq for animations.
		motionStart() // to start motion.
		motionStop() // to stop motion.
		motionPause() // to pause motion.
		motionResume() // to resume paused motion.
		motionToggle() // to pause motion, if it's running. To start motion if it's not. Or just resume.
		getMarkers() // to get multi-dimensional array of markers from all motion sub components.


		//L.motion.polyline and L.motion.polygon
		// - expected duration for motion in milliseconds, can be used after motion is created to start animation
		// and can be used during animation to change object animation duration.
		motionDuration(duration) 

		// - expected motion speed in KM/H, can be used after motion is created to start animation
		// and can be used during animation to change object speed.
		motionSpeed(speed)

		addLatLng(latLng) // - allows to add additional point in the end for the motion animation.

		 // Returns marker (if markerOptions is passed on creation) to attach needed behavior.
		 // Marker will be added to the map only during animation
		getMarker()

		L.motion.seq
		addLayer(layer, autostart) // to append layer to the end of sequence and autostart it if needed


		L.motion.polyline([[13,100], [13,100.5]], {
			color: "transparent"
		}, {
			auto: true,
			duration: 3000,
			easing: L.Motion.Ease.easeInOutQuart
		}, {
			removeOnEnd: true,
			showMarker: true,
			icon: L.divIcon({html: "<i class='fa fa-car fa-2x' aria-hidden='true'></i>", iconSize: L.point(27.5, 24)})
		}).addTo(map);

		L.motion.polyline([{"lat":10,"lng":100},{"lat":11.15611417450841,"lng":99.1906730905175213}], {
			color:"khaki"
		}, null, {
			removeOnEnd: true,
			icon: L.divIcon({html: "<i class='fa fa-plane fa-2x' aria-hidden='true' motion-base='-48'></i>", iconSize: L.point(19, 24)})
		}).motionDuration(7000)

		
		var planePolyline = L.motion.polyline(planeRoute).motionDuration(2000);

		// Build the Sequence Group:
		var seqGroup = L.motion.seq([
			trackPolyline, shipPolyline
		]).addTo(map);

		seqGroup.addLayer(planePolyline, true);
		*/

		/*
			var options = {
		        draw: {
		            circle: false, // Turns off this drawing tool
		            rectangle: false,
		            marker: false,
					circlemarker: false
		        }
		    };

			var drawControl = new L.Control.Draw(options);
		    map.addControl(drawControl);

		    map.on(L.Draw.Event.CREATED, function (e) {
		        var type = e.layerType,
		            layer = e.layer;

				if (type === "polyline") {
					var line = L.motion.polyline(layer.getLatLngs(), {
						color: "orange"
					}, {
						auto: true,
						easing: L.Motion.Ease.swing
					}).motionSpeed(100000).addTo(map);
				}

				if (type === "polygon") {
					L.motion.polygon(layer.getLatLngs(), {
						color: "red",
						fill: true,
						fillOpacity: 0.4
					},{
						auto: true
					}, {
						removeOnEnd: true,
						icon: L.divIcon({className:"red", html: "<i class='fa fa-superpowers fa-spin fa-2x' aria-hidden='true' motion-base='0'></i>", iconSize: L.point(24, 24), iconAnchor: L.point(5, 22)})
					}).motionDuration(10000).addTo(map);
				}
		    });

			var trackRoute = JSON.parse('[{"lat":51.15815239612826,"lng":-2.2055053710937504},{"lat":51.18569785341817,"lng":-2.1615600585937504},{"lat":51.19120493896969,"lng":-2.122009252198041},{"lat":51.22698519222996,"lng":-2.0187377929687504},{"lat":51.20221718842518,"lng":-1.979186986573041},{"lat":51.24211458943536,"lng":-1.8956908676773312},{"lat":51.22285808183325,"lng":-1.8429565429687502},{"lat":51.253114667550555,"lng":-1.7726440262049439},{"lat":51.25036488157529,"lng":-1.7023315094411375},{"lat":51.264112114656214,"lng":-1.6276245284825566},{"lat":51.28472525702113,"lng":-1.56829833984375},{"lat":51.26960987786426,"lng":-1.5309448074549437},{"lat":51.27510698339771,"lng":-1.4891967270523312},{"lat":51.29296795605501,"lng":-1.4474487304687502},{"lat":51.286099169144734,"lng":-1.3837279938161375},{"lat":51.27922935475756,"lng":-1.3397826813161373},{"lat":51.31494117540117,"lng":-1.2694701645523312},{"lat":51.32866911860522,"lng":-1.2057494278997185},{"lat":51.35611262745693,"lng":-1.1266478989273312},{"lat":51.39039390837808,"lng":-1.0695190262049439},{"lat":51.382168736719194,"lng":-1.0057982895523312},{"lat":51.37394211276064,"lng":-0.9596557449549438},{"lat":51.353369031707764,"lng":-0.9025268722325565},{"lat":51.347881294944216,"lng":-0.8651732560247184},{"lat":51.32866911860522,"lng":-0.8234251756221057},{"lat":51.31082203572863,"lng":-0.7860717270523311},{"lat":51.28335135620783,"lng":-0.6981811020523311},{"lat":51.291594301829406,"lng":-0.5905150528997184},{"lat":51.32043285621175,"lng":-0.5267943162471057},{"lat":51.36434245505222,"lng":-0.43670645914971834},{"lat":51.37805558339966,"lng":-0.35321029834449297},{"lat":51.3506252193158,"lng":-0.313659617677331},{"lat":51.32180564750844,"lng":-0.3004760574549437},{"lat":51.29296795605501,"lng":-0.27191153727471834},{"lat":51.27510698339771,"lng":-0.20159910432994368},{"lat":51.31631415723791,"lng":-0.12249740771949293},{"lat":51.361599352206966,"lng":-0.08074949495494367},{"lat":51.36022772609213,"lng":-0.0038450304418802266},{"lat":51.32866906624522,"lng":0.04449474625289441},{"lat":51.30807559747286,"lng":0.08184819482266904},{"lat":51.28747293535334,"lng":0.1367800030857325},{"lat":51.26686102604075,"lng":0.20709243603050712},{"lat":51.2599882819768,"lng":0.2444462198764086},{"lat":51.22148222615174,"lng":0.33453390933573246},{"lat":51.18156698919849,"lng":0.3960574138909579},{"lat":51.14988546610741,"lng":0.4663701821118594},{"lat":51.109908194320916,"lng":0.5718386638909579},{"lat":51.107149852721776,"lng":0.6751100812107326},{"lat":51.053329467578955,"lng":0.7805788982659579},{"lat":51.014650651391285,"lng":0.8377076033502817},{"lat":50.9690233345503,"lng":0.9036255721002818},{"lat":50.93996435333021,"lng":0.9585572127252818},{"lat":50.921966522212145,"lng":0.9651490766555072}]');
			var shipRoute = JSON.parse('[{"lat":50.921966522212145,"lng":0.9651490766555072},{"lat":50.926120475839824,"lng":1.0437014233320954},{"lat":50.94965276094792,"lng":1.1008302960544827},{"lat":50.96210622406778,"lng":1.184326456859708},{"lat":50.98700308620511,"lng":1.2678226176649334},{"lat":51.014650625032424,"lng":1.3710940349847078},{"lat":51.018796350737,"lng":1.4677737560123207},{"lat":51.062994180347005,"lng":1.5600588452070954},{"lat":51.07265684948244,"lng":1.65234393440187},{"lat":51.08093750173957,"lng":1.7358400952070954},{"lat":51.11680330181327,"lng":1.7973634321242573},{"lat":51.136104124419646,"lng":1.8940431531518698},{"lat":51.137482451626596,"lng":2.0126956980675463},{"lat":51.18845145219318,"lng":2.1203612443059687},{"lat":51.1898282161464,"lng":2.2412108536809687},{"lat":51.18569780089507,"lng":2.335693342611194},{"lat":51.207632884080915,"lng":2.427429333329201},{"lat":51.18836197273001,"lng":2.519714422523976},{"lat":51.1677055637131,"lng":2.618591375648976},{"lat":51.129466960517135,"lng":2.6630860380828385}]');
			var carRoute = JSON.parse('[{"lat":51.129466960517135,"lng":2.6630860380828385},{"lat":51.07664802198799,"lng":2.738342452794314},{"lat":51.055941653758396,"lng":2.749328780919314},{"lat":51.00067931792692,"lng":2.7778932172805075},{"lat":50.943967078334666,"lng":2.826233077794314},{"lat":50.89794502437422,"lng":2.867431640625},{"lat":50.846655509682435,"lng":2.9003906250000004},{"lat":50.824458803489804,"lng":2.9619141295552254},{"lat":50.79669804718136,"lng":3.0190430022776127},{"lat":50.76475273687021,"lng":3.1025391630828385},{"lat":50.72444284265441,"lng":3.1772460602223873},{"lat":50.65207604172236,"lng":3.282714877277613},{"lat":50.60469890778924,"lng":3.357421942055226},{"lat":50.562855920362125,"lng":3.425537142902613},{"lat":50.5181824559931,"lng":3.495849743485451},{"lat":50.47905843134065,"lng":3.570556808263064},{"lat":50.47626260659788,"lng":3.629882913082838},{"lat":50.492339146862776,"lng":3.772155828773976},{"lat":50.514693454200405,"lng":3.903991766273976},{"lat":50.510502790942944,"lng":3.9633178710937504},{"lat":50.49792872905663,"lng":4.024841375648976},{"lat":50.48185790425272,"lng":4.073730502277614},{"lat":50.47347053735934,"lng":4.133056774735452},{"lat":50.4776644868276,"lng":4.20336937531829},{"lat":50.479062245100565,"lng":4.231933560222388}]');
			var planeRoute1 = JSON.parse('[{"lat":50.48445898955202,"lng":4.251709654927255},{"lat":50,"lng":0}]');
			var planeRoute2 = JSON.parse('[{"lat":50,"lng":0},{"lat":51.15815239612826,"lng":-2.2055053710937504}]');

			var seqGroup = L.motion.seq([
					L.motion.polyline(trackRoute, {
					color: "orangered"
					}, {
						easing: L.Motion.Ease.easeInOutQuad
					}, {
						removeOnEnd: true,
						icon: L.divIcon({html: "<i class='fa fa-truck fa-2x fa-flip-horizontal' aria-hidden='true'></i>", iconSize: L.point(27.5, 24)})
					}).motionDuration(8000),
					L.motion.polyline(shipRoute, {
						color: "steelblue"
					}, {
						easing: L.Motion.Ease.easeInOutQuart
					}, {
						removeOnEnd: true,
						showMarker: true,
						icon: L.divIcon({html: "<i class='fa fa-ship fa-2x' aria-hidden='true'></i>", iconSize: L.point(27.5, 24)})
					}).motionDuration(9000),
					L.motion.polyline(carRoute, {
						colors: "SlateGrey"
					}, {
						easing: L.Motion.Ease.easeInOutElastic
					}, {
						removeOnEnd: true,
						icon: L.divIcon({html: "<i class='fa fa-car fa-2x' aria-hidden='true'></i>", iconSize: L.point(27.5, 24)})
					}).motionDuration(7000),
					L.motion.seq([L.motion.polyline(planeRoute1, {
									color:"indigo"
								}, null, {
									removeOnEnd: false,
									icon: L.divIcon({html: "<i class='fa fa-plane fa-2x' aria-hidden='true' motion-base='-43'></i>", iconSize: L.point(19, 24)})
								}).motionDuration(5000),
								L.motion.polyline(planeRoute2, {
									color:"khaki"
								}, null).motionDuration(7000)
							])
				]).addTo(map);


			seqGroup.on("click", function(){
				seqGroup.motionStart();
			});

			seqGroup.on("dblclick", function(e){
				seqGroup.motionToggle();
			});

			setTimeout(function () {
				seqGroup.motionStart();
			}, 1000);


			*/

	</script>


	<script src="leaflet/PathDashFlow/L.Path.DashFlow.js"></script>
	<script>

	var routedash = [[10.452339,98.96291],[10.452011,99.06479],[11.457001,99.26758],[12.45797,100.06776]];

		for (var i = 0, latlngs_ = [], len = routedash.length; i < len; i++) {
			latlngs_.push(new L.LatLng(routedash[i][0], routedash[i][1]));
		}

		var path = L.polyline(latlngs_, {
			dashArray: "15,15",
			dashSpeed: -30
		});

		map.fitBounds(L.latLngBounds(latlngs_));

		map.addLayer(L.marker(latlngs_[0]));
		map.addLayer(L.marker(latlngs_[len - 1]));

		map.addLayer(path);

		L.circleMarker([10, 99], {
			dashArray: "15,15",
			dashSpeed: -30,
			radius: 147.5
		}).addTo(map);

		/*
		var line = L.polyline(latlngs, {dashArray: "15 15", dashSpeed: 30});
		line.addTo(map);
		*/

	</script>


	<script src="leaflet/PolylineSnakeAnim/L.Polyline.SnakeAnim.js"></script>
	<script>

		var latlngs__ = [[11.452339,99.00291],[12.05,99.02479],[12.119,99.46758],[12.53797,99.42776]];
		var airport1 = [11.792339,99.80291];
		var airport2 = [12.102339,102.22291];


		var linet = L.polyline(latlngs__, {snakingSpeed: 40});
		linet.addTo(map).snakeIn();

		var routet = L.layerGroup([
			L.marker(airport1),
			L.polyline([airport1, airport2]),
			L.marker(airport2)
		], { snakingPause: 200 });
		routet.addTo(map).snakeIn();
	</script>


	
  <script src="leaflet/antpath/dist/leaflet-ant-path.js?v=001"></script>
	<script>

		var latlngsline = [[12.9237, 101.0090],[12.90877, 101.028856],[12.8855, 101.022578]];

  // Using the constructor...
    let antPolyline = new L.Polyline.AntPath(latlngsline, {
    					color: '#0000FF', 
  						weight: 5,
							//paused:false,
							//reverse:false,
							//hardwareAccelerated:false,
							pulseColor:'#FFFFFF',
							delay:'800',
							dashArray:[40, 60]//"15, 30"*/ตัวเลขสีอ่อนเยอะ ตัวสองสีเข้มเยอะ
		});
    
    // ... or use the factory
    //antPolyline = L.polyline.antPath(latlngs, options);
    
    antPolyline.addTo(map);


		//"use": L.rectangle,

		// Using a polygon
		let antPolygon = new L.Polyline.AntPath([
		  [12.8789, 100.98],
		  [12.8680, 101.06],
		  [12.8558, 101.096],  
		  [12.86883, 100.997]
		], { use: L.polygon, fillColor: "red" }).addTo(map);

		// Using a circle
		let antCircle = new L.Polyline.AntPath(
		  [12.838, 100.9611],
		  {
		    use: L.circle,
		    color: 'red',
		    fillColor: '#f03',
		    fillOpacity: 0.5,
		    radius: 500
		  }
		).addTo(map);


    map.fitBounds(antPolyline.getBounds());

		/*
		antPolyline.pause()
		antPolyline.resume()
		antPolyline.reverse()
		*/
 	</script>



  <script src="leaflet/animatedmaker/src/AnimatedMarker.js?v=001"></script>
	<script>

		var myIcon = L.icon({
		  iconUrl: 'car.png',
		  iconSize: [30, 30], // size of the icon
      //iconAnchor: [5, 5], // point of the icon which will correspond to marker's location
      //popupAnchor: [0, -5] // point from which the popup should open relative to the iconAnchor'
		});

		var line = L.polyline([[12.9237, 101.0090],[12.90877, 101.028856],[12.88533, 101.025978]]);

		var animatedMarker = L.animatedMarker(line.getLatLngs(), {
			icon: myIcon,
		  distance: 300,  // meters
		  interval: 2000, // milliseconds
		  autoStart: false,
		  onEnd: function() {
		    // TODO: blow up this marker
		  }
		});

		map.addLayer(animatedMarker);

		// Start when you're ready
		animatedMarker.start();

		setTimeout(function() {
		  // Stop the animation
		  animatedMarker.stop();
		}, 10000);

 	</script>

	-->



	<script src="leaflet/measure-path/leaflet-measure-path_dev.js?v=004" type="text/javascript"></script>
	<link rel="stylesheet" href="leaflet/measure-path/leaflet-measure-path_dev.css?v=002" />

	<script src="leaflet/number-marker/leaflet_numbered_markers.js?v=001" type="text/javascript"></script>
	<link rel="stylesheet" href="leaflet/number-marker/leaflet_numbered_markers.css?v=001" />

	<script src="core/js/measure.js?v=004" type="text/javascript"></script>



	<script>

		$( document ).ready(function() {

		});

		map.on('click', function(e) {
		    console.log(e.latlng); // e is an event object (MouseEvent in this case)
		    $('.leaflet-bar.leaflet-bookmarks-control.leaflet-control.expanded').removeClass('expanded');
		}); 

		(function() {

		    var beforePrint = function() {
		        //console.log('Functionality to run before printing.');
						//$('.sharebtn').hide();
						$('#mappaint-map').css('height','27.5cm');
						$('#mappaint-map').css('border','1px solid black');
		  				map.invalidateSize();


		  				
						edgeGrat.addTo(map);
						//$('canvas.leaflet-zoom-animated').css('background-color','');
						$('canvas.leaflet-zoom-animated').css('opacity','0.6');
						$('canvas.leaflet-zoom-animated').css('filter',' alpha(opacity=60)');					
						//$('.leaflet-zoom-hide').css('opacity','0.5');
					  //$('.leaflet-zoom-animated').css('display','none');
						//$('.leaflet-zoom-hide').css('background','transparent');
						//$('.leaflet-zoom-animated').css('background','transparent');
						//$('.leaflet-zoom-animated').css('opacity','0.5');
						//$('.leaflet-zoom-animated').css('filter',' alpha(opacity=50)');
						
						edgeBar.addTo(map);
						//$('.leaflet-image-layer').css('background','');
						$('.leaflet-image-layer').css('opacity','0.5');
						$('.leaflet-image-layer').css('filter',' alpha(opacity=50)');
						//edgeBar.bringToBack();
						//edgeBar.bringToFront();
						//opacity: 0; //tran
		  				//filter: alpha(opacity=0); // For IE8 and earlier  //tran
		  				
						/*
		  				$.ajax({
							 type:'POST',
							 url:'printby.php',
							 async:false,
							 dataType: 'json',
							 success:function(res){
							   //console.log(data);
							   if(res[0]['data'] == '-'){
							   	res[0]['data'] += 'NONE';
							   }
								$('#map').after('<div class="watermark" style="z-index:9999;">PWA'+res[0]['data']+'</div>');
							 }
							}).done(function() { 
							  //alert('Done!');
							});
		  				
		  				//$('#map').after('<div class="watermark" style="z-index:9999;">PWA'+localStorage.getItem('acc-m')+'</div>');
		  				*/
		    };

		    var afterPrint = function() {
		        //console.log('Functionality to run after printing');
		        //$('.sharebtn').show();
		        //$('.watermark').remove();
		        $('#mappaint-map').css('height','100%');
		        $('#mappaint-map').css('border','0px solid black'); 


				$('leaflet-image-layer').css('opacity','1');
				$('leaflet-image-layer').css('filter',' alpha(opacity=100)');
				edgeGrat.removeFrom(map);					

				//$('.leaflet-image-layer').css('background','');
				$('leaflet-image-layer').css('opacity','1');
				$('leaflet-image-layer').css('filter',' alpha(opacity=100)');
		        edgeBar.removeFrom(map);
				
		         
		        return;
		    };
		    
		    if (window.matchMedia) {
		        var mediaQueryList = window.matchMedia('print');
		        mediaQueryList.addListener(function(mql) {
		            if (mql.matches) {
		            			map.invalidateSize();
		                //beforePrint();
		            } else {
		            			map.invalidateSize();
		                //afterPrint();
		            }
		        });
		    }
				
		    window.onbeforeprint = beforePrint;
		    window.onafterprint = afterPrint;

		}());

		function forPrint(){

		  var defer = $.Deferred(),
		    filtered = defer.then(function( value ) {
		    	console.log('1');
				$('#mappaint-map').css('height','27.5cm');
				$('#mappaint-map').css('border','1px solid black');
				map.invalidateSize();
		    });
		 
		  defer.resolve( 1 );
		  filtered.done(function( value ) {

				console.log('2');
				setTimeout(function(){ 
						setTimeout(function(){ 
						  	map.invalidateSize();
						}, 1000);
					  	window.print();
				}, 1000);

		  });

			  				
		}




	</script>





</body>
</html>
